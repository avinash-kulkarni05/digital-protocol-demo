{
  "stage": 4,
  "stageName": "Alternative Resolution",
  "success": true,
  "expansions": [
    {
      "id": "EXP-ACT-016",
      "originalActivityId": "ACT-016",
      "originalActivityName": "Echocardiogram/MUGA",
      "expandedActivities": [
        {
          "id": "ACT-016-A",
          "name": "Echocardiogram",
          "instanceType": "Activity",
          "cdiscDomain": null,
          "_alternativeResolution": {
            "originalActivityId": "ACT-016",
            "originalActivityName": "Echocardiogram/MUGA",
            "alternativeType": "mutually_exclusive",
            "alternativeIndex": 1,
            "alternativeCount": 2,
            "confidence": 1.0,
            "rationale": "The '/' separates two distinct and mutually exclusive procedures for assessing cardiac function. A site will perform one or the other, not both.",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103180Z",
            "source": "llm",
            "cacheHit": false,
            "cacheKey": "ee1add773e9b25a7981eb0aa8bbcd9ff"
          }
        },
        {
          "id": "ACT-016-B",
          "name": "MUGA",
          "instanceType": "Activity",
          "cdiscDomain": null,
          "_alternativeResolution": {
            "originalActivityId": "ACT-016",
            "originalActivityName": "Echocardiogram/MUGA",
            "alternativeType": "mutually_exclusive",
            "alternativeIndex": 2,
            "alternativeCount": 2,
            "confidence": 1.0,
            "rationale": "The '/' separates two distinct and mutually exclusive procedures for assessing cardiac function. A site will perform one or the other, not both.",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103855Z",
            "source": "llm",
            "cacheHit": false,
            "cacheKey": "ee1add773e9b25a7981eb0aa8bbcd9ff"
          }
        }
      ],
      "expandedSais": [
        {
          "id": "SAI-045-A",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-A",
          "scheduledInstanceEncounterId": "ENC-002",
          "defaultConditionId": "COND-ALT-016-A",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-045",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 1,
            "alternativeName": "Echocardiogram",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103786Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-046-A",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-A",
          "scheduledInstanceEncounterId": "ENC-006",
          "defaultConditionId": "COND-ALT-016-A",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-046",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 1,
            "alternativeName": "Echocardiogram",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103844Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-047-A",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-A",
          "scheduledInstanceEncounterId": "ENC-007",
          "defaultConditionId": "COND-ALT-016-A",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-047",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 1,
            "alternativeName": "Echocardiogram",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103850Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-045-B",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-B",
          "scheduledInstanceEncounterId": "ENC-002",
          "defaultConditionId": "COND-ALT-016-B",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-045",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 2,
            "alternativeName": "MUGA",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103866Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-046-B",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-B",
          "scheduledInstanceEncounterId": "ENC-006",
          "defaultConditionId": "COND-ALT-016-B",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-046",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 2,
            "alternativeName": "MUGA",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103869Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-047-B",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-016-B",
          "scheduledInstanceEncounterId": "ENC-007",
          "defaultConditionId": "COND-ALT-016-B",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-047",
            "originalActivityId": "ACT-016",
            "alternativeIndex": 2,
            "alternativeName": "MUGA",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103872Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        }
      ],
      "conditionsCreated": [
        {
          "id": "COND-ALT-016-A",
          "instanceType": "Condition",
          "name": "Echocardiogram selected",
          "text": "Subject assigned to Echocardiogram option for Echocardiogram/MUGA",
          "conditionType": {
            "id": "CODE-COND-TYPE-EXT-ALT-002",
            "code": "EXT-ALT-002",
            "decode": "Mutually Exclusive Alternative",
            "codeSystem": "http://protocol-digitalization.example.org/codesystem/soa-alternative-resolution",
            "codeSystemVersion": "1.0.0",
            "instanceType": "Code"
          },
          "_alternativeResolution": {
            "originalActivityId": "ACT-016",
            "alternativeIndex": 1,
            "alternativeName": "Echocardiogram",
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103763Z"
          }
        },
        {
          "id": "COND-ALT-016-B",
          "instanceType": "Condition",
          "name": "MUGA selected",
          "text": "Subject assigned to MUGA option for Echocardiogram/MUGA",
          "conditionType": {
            "id": "CODE-COND-TYPE-EXT-ALT-002",
            "code": "EXT-ALT-002",
            "decode": "Mutually Exclusive Alternative",
            "codeSystem": "http://protocol-digitalization.example.org/codesystem/soa-alternative-resolution",
            "codeSystemVersion": "1.0.0",
            "instanceType": "Code"
          },
          "_alternativeResolution": {
            "originalActivityId": "ACT-016",
            "alternativeIndex": 2,
            "alternativeName": "MUGA",
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103864Z"
          }
        }
      ],
      "assignmentsCreated": [
        {
          "id": "CA-ALT-76BDC8",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-A",
          "conditionTargetId": "SAI-045-A",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103840Z"
          }
        },
        {
          "id": "CA-ALT-3BDDC6",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-A",
          "conditionTargetId": "SAI-046-A",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103849Z"
          }
        },
        {
          "id": "CA-ALT-293FFB",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-A",
          "conditionTargetId": "SAI-047-A",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103852Z"
          }
        },
        {
          "id": "CA-ALT-1CE1CC",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-B",
          "conditionTargetId": "SAI-045-B",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103868Z"
          }
        },
        {
          "id": "CA-ALT-C3D8CD",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-B",
          "conditionTargetId": "SAI-046-B",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103871Z"
          }
        },
        {
          "id": "CA-ALT-9AB21C",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-016-B",
          "conditionTargetId": "SAI-047-B",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103879Z"
          }
        }
      ],
      "confidence": 1.0,
      "alternativeType": "mutually_exclusive",
      "requiresReview": false,
      "reviewReason": null
    },
    {
      "id": "EXP-ACT-017",
      "originalActivityId": "ACT-017",
      "originalActivityName": "MRI/Contrast CT of Brain",
      "expandedActivities": [
        {
          "id": "ACT-017-A",
          "name": "MRI of Brain",
          "instanceType": "Activity",
          "cdiscDomain": null,
          "_alternativeResolution": {
            "originalActivityId": "ACT-017",
            "originalActivityName": "MRI/Contrast CT of Brain",
            "alternativeType": "mutually_exclusive",
            "alternativeIndex": 1,
            "alternativeCount": 2,
            "confidence": 1.0,
            "rationale": "The '/' separates two distinct, mutually exclusive imaging modalities for the brain. A choice must be made between performing an MRI or a Contrast CT.",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.103902Z",
            "source": "llm",
            "cacheHit": false,
            "cacheKey": "09f99cbe9363e166f6dfd2ca76dda9ec"
          }
        },
        {
          "id": "ACT-017-B",
          "name": "Contrast CT of Brain",
          "instanceType": "Activity",
          "cdiscDomain": null,
          "_alternativeResolution": {
            "originalActivityId": "ACT-017",
            "originalActivityName": "MRI/Contrast CT of Brain",
            "alternativeType": "mutually_exclusive",
            "alternativeIndex": 2,
            "alternativeCount": 2,
            "confidence": 1.0,
            "rationale": "The '/' separates two distinct, mutually exclusive imaging modalities for the brain. A choice must be made between performing an MRI or a Contrast CT.",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.104116Z",
            "source": "llm",
            "cacheHit": false,
            "cacheKey": "09f99cbe9363e166f6dfd2ca76dda9ec"
          }
        }
      ],
      "expandedSais": [
        {
          "id": "SAI-048-A",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-017-A",
          "scheduledInstanceEncounterId": "ENC-002",
          "defaultConditionId": "COND-ALT-017-A",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-048",
            "originalActivityId": "ACT-017",
            "alternativeIndex": 1,
            "alternativeName": "MRI of Brain",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.104108Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        },
        {
          "id": "SAI-048-B",
          "instanceType": "ScheduledActivityInstance",
          "activityId": "ACT-017-B",
          "scheduledInstanceEncounterId": "ENC-002",
          "defaultConditionId": "COND-ALT-017-B",
          "isRequired": true,
          "footnoteMarkers": [],
          "_alternativeResolution": {
            "originalSaiId": "SAI-048",
            "originalActivityId": "ACT-017",
            "alternativeIndex": 2,
            "alternativeName": "Contrast CT of Brain",
            "stage": "Stage4AlternativeResolution",
            "model": "gemini-2.5-pro",
            "timestamp": "2025-12-10T00:23:37.104124Z",
            "confidence": 1.0,
            "source": "llm",
            "cacheHit": false
          },
          "timingModifier": null
        }
      ],
      "conditionsCreated": [
        {
          "id": "COND-ALT-017-A",
          "instanceType": "Condition",
          "name": "MRI of Brain selected",
          "text": "Subject assigned to MRI of Brain option for MRI/Contrast CT of Brain",
          "conditionType": {
            "id": "CODE-COND-TYPE-EXT-ALT-002",
            "code": "EXT-ALT-002",
            "decode": "Mutually Exclusive Alternative",
            "codeSystem": "http://protocol-digitalization.example.org/codesystem/soa-alternative-resolution",
            "codeSystemVersion": "1.0.0",
            "instanceType": "Code"
          },
          "_alternativeResolution": {
            "originalActivityId": "ACT-017",
            "alternativeIndex": 1,
            "alternativeName": "MRI of Brain",
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.103910Z"
          }
        },
        {
          "id": "COND-ALT-017-B",
          "instanceType": "Condition",
          "name": "Contrast CT of Brain selected",
          "text": "Subject assigned to Contrast CT of Brain option for MRI/Contrast CT of Brain",
          "conditionType": {
            "id": "CODE-COND-TYPE-EXT-ALT-002",
            "code": "EXT-ALT-002",
            "decode": "Mutually Exclusive Alternative",
            "codeSystem": "http://protocol-digitalization.example.org/codesystem/soa-alternative-resolution",
            "codeSystemVersion": "1.0.0",
            "instanceType": "Code"
          },
          "_alternativeResolution": {
            "originalActivityId": "ACT-017",
            "alternativeIndex": 2,
            "alternativeName": "Contrast CT of Brain",
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.104122Z"
          }
        }
      ],
      "assignmentsCreated": [
        {
          "id": "CA-ALT-E5CCC8",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-017-A",
          "conditionTargetId": "SAI-048-A",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.104113Z"
          }
        },
        {
          "id": "CA-ALT-78D110",
          "instanceType": "ConditionAssignment",
          "conditionId": "COND-ALT-017-B",
          "conditionTargetId": "SAI-048-B",
          "_alternativeResolution": {
            "stage": "Stage4AlternativeResolution",
            "timestamp": "2025-12-10T00:23:37.104126Z"
          }
        }
      ],
      "confidence": 1.0,
      "alternativeType": "mutually_exclusive",
      "requiresReview": false,
      "reviewReason": null
    }
  ],
  "decisions": {
    "ACT-007": {
      "activityId": "ACT-005",
      "activityName": "Inclusion/Exclusion Criteria",
      "isAlternative": false,
      "alternativeType": null,
      "alternatives": [],
      "recommendedAction": "keep",
      "confidence": 1.0,
      "rationale": "This is a procedural check against a set of criteria, not a choice between different assessments to be performed.",
      "source": "cache",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-09T02:56:44.556064Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-006": {
      "activityId": "ACT-006",
      "activityName": "Medical/Surgical History",
      "isAlternative": false,
      "alternativeType": null,
      "alternatives": [],
      "recommendedAction": "keep",
      "confidence": 1.0,
      "rationale": "The '/' connects two components of a single, comprehensive history-taking activity. It is not a choice between performing one or the other; both are collected.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.100520Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-014": {
      "activityId": "ACT-014",
      "activityName": "Clinical Chemistry/Haematology/Urinalysis",
      "isAlternative": false,
      "alternativeType": null,
      "alternatives": [],
      "recommendedAction": "keep",
      "confidence": 1.0,
      "rationale": "This is a list of standard laboratory panels that are all required. The '/' separates items in a list of tests to be performed, not mutually exclusive options.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.101555Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-016": {
      "activityId": "ACT-016",
      "activityName": "Echocardiogram/MUGA",
      "isAlternative": true,
      "alternativeType": "mutually_exclusive",
      "alternatives": [
        {
          "name": "Echocardiogram",
          "order": 1,
          "confidence": 1.0,
          "cdiscDomain": null,
          "isPreferred": false
        },
        {
          "name": "MUGA",
          "order": 2,
          "confidence": 1.0,
          "cdiscDomain": null,
          "isPreferred": false
        }
      ],
      "recommendedAction": "expand",
      "confidence": 1.0,
      "rationale": "The '/' separates two distinct and mutually exclusive procedures for assessing cardiac function. A site will perform one or the other, not both.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.101595Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-017": {
      "activityId": "ACT-017",
      "activityName": "MRI/Contrast CT of Brain",
      "isAlternative": true,
      "alternativeType": "mutually_exclusive",
      "alternatives": [
        {
          "name": "MRI of Brain",
          "order": 1,
          "confidence": 1.0,
          "cdiscDomain": null,
          "isPreferred": false
        },
        {
          "name": "Contrast CT of Brain",
          "order": 2,
          "confidence": 1.0,
          "cdiscDomain": null,
          "isPreferred": false
        }
      ],
      "recommendedAction": "expand",
      "confidence": 1.0,
      "rationale": "The '/' separates two distinct, mutually exclusive imaging modalities for the brain. A choice must be made between performing an MRI or a Contrast CT.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.101605Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-026": {
      "activityId": "ACT-026",
      "activityName": "Treatment Dispensed/Returned",
      "isAlternative": false,
      "alternativeType": null,
      "alternatives": [],
      "recommendedAction": "keep",
      "confidence": 1.0,
      "rationale": "'Dispensed' and 'Returned' are two parts of the drug accountability process, not a choice between two different procedures. They are not mutually exclusive and can occur at the same visit.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.101608Z",
      "modelName": "gemini-2.5-pro"
    },
    "ACT-029": {
      "activityId": "ACT-029",
      "activityName": "Subsequent Response/Progression Data",
      "isAlternative": false,
      "alternativeType": null,
      "alternatives": [],
      "recommendedAction": "keep",
      "confidence": 1.0,
      "rationale": "'Response' and 'Progression' are potential outcomes of a single tumor assessment activity, not a choice between two different activities to perform. The name describes the data being collected.",
      "source": "llm",
      "requiresHumanReview": false,
      "reviewReason": null,
      "cachedAt": "2025-12-10T00:23:37.101611Z",
      "modelName": "gemini-2.5-pro"
    }
  },
  "reviewItems": [],
  "metrics": {
    "activitiesAnalyzed": 7,
    "alternativesDetected": 2,
    "activitiesExpanded": 2,
    "saisCreated": 8,
    "conditionsCreated": 4,
    "assignmentsCreated": 8,
    "autoApplied": 2,
    "needsReview": 0,
    "timingPatternsFiltered": 0,
    "unitPatternsFiltered": 0,
    "cacheHits": 1,
    "llmCalls": 1,
    "validationDiscrepancies": 0,
    "referentialIntegrityErrors": 0
  }
}