{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ImagingCentralReading",
  "description": "USDM 4.0-compliant schema for imaging assessments and central reading extraction. Covers RECIST 1.1, iRECIST, tumor assessments, imaging modalities, and blinded independent central review (BICR) requirements.",
  "type": "object",
  "definitions": {
    "provenance": {
      "type": "object",
      "description": "Source location information for audit trail - populated in Pass 2 only",
      "properties": {
        "section_number": {
          "type": ["string", "null"],
          "description": "Section number from document (e.g., '8.3', '10.2')",
          "maxLength": 50
        },
        "page_number": {
          "type": ["integer", "null"],
          "description": "PDF page number (1-indexed)"
        },
        "text_snippet": {
          "type": ["string", "null"],
          "description": "Direct quote from source (max 500 chars)",
          "maxLength": 500
        }
      }
    },
    "time_window": {
      "type": "object",
      "description": "Time window for assessments",
      "properties": {
        "value": {
          "type": ["number", "null"],
          "description": "Numeric time value"
        },
        "unit": {
          "type": ["string", "null"],
          "enum": ["days", "weeks", "cycles", "months", null],
          "description": "Time unit"
        },
        "window_plus": {
          "type": ["number", "null"],
          "description": "Positive window tolerance"
        },
        "window_minus": {
          "type": ["number", "null"],
          "description": "Negative window tolerance"
        }
      }
    }
  },
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this imaging resource",
      "maxLength": 50
    },
    "instanceType": {
      "type": "string",
      "const": "ImagingCentralReading",
      "description": "USDM instance type"
    },
    "name": {
      "type": "string",
      "description": "Name of the imaging assessment resource",
      "maxLength": 200
    },
    "description": {
      "type": ["string", "null"],
      "description": "Brief description of the imaging program",
      "maxLength": 500
    },
    "response_criteria": {
      "type": "object",
      "description": "Tumor response assessment criteria",
      "properties": {
        "primary_criteria": {
          "type": ["string", "null"],
          "description": "Primary response criteria (RECIST 1.1, iRECIST, mRECIST, Lugano, RANO, etc.)",
          "maxLength": 100
        },
        "criteria_version": {
          "type": ["string", "null"],
          "description": "Version of criteria (e.g., 1.1, 2017)",
          "maxLength": 50
        },
        "secondary_criteria": {
          "type": ["array", "null"],
          "items": {"type": "string", "maxLength": 100},
          "description": "Additional response criteria used"
        },
        "modifications": {
          "type": ["string", "null"],
          "description": "Any protocol-specific modifications to standard criteria",
          "maxLength": 500
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "imaging_modalities": {
      "type": "array",
      "description": "Imaging modalities used in the study",
      "items": {
        "type": "object",
        "properties": {
          "modality_id": {
            "type": "string",
            "description": "Unique modality identifier (e.g., IMG-001)",
            "maxLength": 50
          },
          "modality_type": {
            "type": "string",
            "description": "Type of imaging (CT, MRI, PET, PET-CT, X-ray, ultrasound, bone scan)",
            "maxLength": 50
          },
          "body_regions": {
            "type": ["array", "null"],
            "items": {"type": "string", "maxLength": 100},
            "description": "Body regions covered (chest, abdomen, pelvis, brain, whole body)"
          },
          "contrast_required": {
            "type": ["boolean", "null"],
            "description": "Whether contrast agent is required"
          },
          "contrast_type": {
            "type": ["string", "null"],
            "description": "Type of contrast agent if applicable",
            "maxLength": 100
          },
          "slice_thickness": {
            "type": ["string", "null"],
            "description": "Required slice thickness (e.g., ≤5mm)",
            "maxLength": 50
          },
          "technical_requirements": {
            "type": ["string", "null"],
            "description": "Technical specifications for imaging",
            "maxLength": 500
          },
          "preferred_modality": {
            "type": ["boolean", "null"],
            "description": "Whether this is the preferred modality"
          },
          "provenance": {
            "$ref": "#/definitions/provenance"
          }
        },
        "required": ["modality_id", "modality_type"]
      }
    },
    "assessment_schedule": {
      "type": "object",
      "description": "Schedule for tumor assessments",
      "properties": {
        "baseline_window": {
          "type": ["string", "null"],
          "description": "Window for baseline assessment (e.g., within 28 days prior to first dose)",
          "maxLength": 200
        },
        "on_treatment_frequency": {
          "type": ["string", "null"],
          "description": "Frequency during treatment (e.g., every 6 weeks, every 2 cycles)",
          "maxLength": 200
        },
        "first_assessment_timing": {
          "type": ["string", "null"],
          "description": "Timing of first on-treatment assessment",
          "maxLength": 200
        },
        "post_treatment_schedule": {
          "type": ["string", "null"],
          "description": "Schedule after treatment discontinuation",
          "maxLength": 500
        },
        "confirmatory_scan_required": {
          "type": ["boolean", "null"],
          "description": "Whether confirmatory scans are required for response"
        },
        "confirmatory_scan_window": {
          "type": ["string", "null"],
          "description": "Window for confirmatory scan (e.g., ≥4 weeks after initial response)",
          "maxLength": 200
        },
        "assessment_timepoints": {
          "type": ["array", "null"],
          "items": {
            "oneOf": [
              {"type": "string", "maxLength": 500},
              {
                "type": "object",
                "properties": {
                  "timepoint_name": {
                    "type": "string",
                    "description": "Name of timepoint (Screening, Week 6, Cycle 3 Day 1)",
                    "maxLength": 100
                  },
                  "timing_description": {
                    "type": ["string", "null"],
                    "description": "Detailed timing description",
                    "maxLength": 300
                  },
                  "window": {
                    "$ref": "#/definitions/time_window"
                  }
                }
              }
            ]
          },
          "description": "Specific assessment timepoints - can be strings or structured objects"
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "lesion_requirements": {
      "type": "object",
      "description": "Target and non-target lesion definitions",
      "properties": {
        "measurable_disease_definition": {
          "type": ["string", "null"],
          "description": "Definition of measurable disease",
          "maxLength": 500
        },
        "target_lesion_minimum_size": {
          "type": ["string", "null"],
          "description": "Minimum size for target lesions (e.g., ≥10mm longest diameter)",
          "maxLength": 300
        },
        "lymph_node_criteria": {
          "type": ["string", "null"],
          "description": "Criteria for lymph node measurement (e.g., ≥15mm short axis)",
          "maxLength": 200
        },
        "max_target_lesions": {
          "type": ["integer", "null"],
          "description": "Maximum number of target lesions (typically 5 total, 2 per organ)"
        },
        "max_target_lesions_per_organ": {
          "type": ["integer", "null"],
          "description": "Maximum target lesions per organ"
        },
        "non_target_lesion_definition": {
          "type": ["string", "null"],
          "description": "Definition of non-target lesions",
          "maxLength": 300
        },
        "non_measurable_disease": {
          "type": ["array", "null"],
          "items": {"type": "string", "maxLength": 200},
          "description": "Types of non-measurable disease (bone lesions, leptomeningeal disease, ascites)"
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "response_categories": {
      "type": "array",
      "description": "Response assessment categories",
      "items": {
        "type": "object",
        "properties": {
          "category_code": {
            "type": "string",
            "description": "Response category code (CR, PR, SD, PD, NE)",
            "maxLength": 20
          },
          "category_name": {
            "type": "string",
            "description": "Full category name",
            "maxLength": 100
          },
          "definition": {
            "type": ["string", "null"],
            "description": "Definition of response category",
            "maxLength": 500
          },
          "target_lesion_criteria": {
            "type": ["string", "null"],
            "description": "Criteria for target lesions",
            "maxLength": 300
          },
          "non_target_lesion_criteria": {
            "type": ["string", "null"],
            "description": "Criteria for non-target lesions",
            "maxLength": 300
          },
          "new_lesion_criteria": {
            "type": ["string", "null"],
            "description": "New lesion requirements",
            "maxLength": 200
          },
          "provenance": {
            "$ref": "#/definitions/provenance"
          }
        },
        "required": ["category_code", "category_name"]
      }
    },
    "central_reading": {
      "type": "object",
      "description": "Blinded Independent Central Review (BICR) requirements",
      "properties": {
        "bicr_required": {
          "type": ["boolean", "null"],
          "description": "Whether BICR is required"
        },
        "bicr_purpose": {
          "type": ["string", "null"],
          "description": "Purpose of central reading (primary endpoint, sensitivity analysis)",
          "maxLength": 200
        },
        "reading_methodology": {
          "type": ["string", "null"],
          "description": "Methodology (single reader, dual reader with adjudication)",
          "maxLength": 200
        },
        "reader_qualifications": {
          "type": ["string", "null"],
          "description": "Required qualifications for central readers",
          "maxLength": 300
        },
        "blinding_requirements": {
          "type": ["string", "null"],
          "description": "Blinding requirements for central readers",
          "maxLength": 300
        },
        "adjudication_process": {
          "type": ["string", "null"],
          "description": "Process for resolving discrepancies between readers",
          "maxLength": 300
        },
        "vendor_name": {
          "type": ["string", "null"],
          "description": "Central imaging vendor name",
          "maxLength": 200
        },
        "turnaround_time": {
          "type": ["string", "null"],
          "description": "Expected turnaround time for central reads",
          "maxLength": 100
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "image_submission": {
      "type": "object",
      "description": "Requirements for submitting images to central reader",
      "properties": {
        "submission_method": {
          "type": ["string", "null"],
          "description": "Method for image submission (electronic transfer, PACS, physical media)",
          "maxLength": 200
        },
        "format_requirements": {
          "type": ["string", "null"],
          "description": "Required image formats (DICOM, etc.)",
          "maxLength": 200
        },
        "anonymization_requirements": {
          "type": ["string", "null"],
          "description": "Patient de-identification requirements",
          "maxLength": 300
        },
        "submission_timeline": {
          "type": ["string", "null"],
          "description": "Timeline for submitting images after acquisition",
          "maxLength": 500
        },
        "quality_requirements": {
          "type": ["string", "null"],
          "description": "Image quality requirements",
          "maxLength": 300
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "special_assessments": {
      "type": ["array", "null"],
      "description": "Special or disease-specific imaging assessments",
      "items": {
        "type": "object",
        "properties": {
          "assessment_id": {
            "type": "string",
            "description": "Unique assessment identifier",
            "maxLength": 50
          },
          "assessment_name": {
            "type": "string",
            "description": "Name of special assessment (bone scan, brain MRI, PET response)",
            "maxLength": 100
          },
          "purpose": {
            "type": ["string", "null"],
            "description": "Purpose of this assessment",
            "maxLength": 300
          },
          "methodology": {
            "type": ["string", "null"],
            "description": "Methodology or criteria used",
            "maxLength": 500
          },
          "schedule": {
            "type": ["string", "null"],
            "description": "When this assessment is performed",
            "maxLength": 400
          },
          "provenance": {
            "$ref": "#/definitions/provenance"
          }
        },
        "required": ["assessment_id", "assessment_name"]
      }
    },
    "immune_related_criteria": {
      "type": ["object", "null"],
      "description": "Immune-related response criteria (iRECIST) if applicable",
      "properties": {
        "irecist_used": {
          "type": ["boolean", "null"],
          "description": "Whether iRECIST is used"
        },
        "pseudoprogression_handling": {
          "type": ["string", "null"],
          "description": "How pseudoprogression is assessed and confirmed",
          "maxLength": 500
        },
        "confirmation_requirements": {
          "type": ["string", "null"],
          "description": "Requirements to confirm immune-related progression",
          "maxLength": 300
        },
        "treatment_beyond_progression": {
          "type": ["string", "null"],
          "description": "Policy for treatment beyond initial progression",
          "maxLength": 300
        },
        "provenance": {
          "$ref": "#/definitions/provenance"
        }
      }
    },
    "extraction_statistics": {
      "type": "object",
      "description": "Extraction metadata - auto-generated",
      "properties": {
        "has_response_criteria": {"type": "boolean"},
        "has_bicr": {"type": "boolean"},
        "has_immune_criteria": {"type": "boolean"},
        "modality_count": {"type": ["integer", "null"]},
        "response_category_count": {"type": ["integer", "null"]}
      }
    },
    "provenance": {
      "$ref": "#/definitions/provenance"
    }
  },
  "required": ["id", "instanceType", "name"]
}
