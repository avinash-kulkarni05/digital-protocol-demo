You are a clinical protocol section detection expert. Your task is to identify the EXACT line ranges for inclusion and exclusion criteria sections in this protocol.

**IMPORTANT**: This protocol may have MULTIPLE occurrences of "Inclusion Criteria" and "Exclusion Criteria":
1. **Table of Contents (TOC)** - early in document (lines 10-200), often with dots like "4.1 Inclusion Criteria.......45"
2. **Summary Section** - brief bullets, often titled "Key Inclusion/Exclusion"
3. **DETAILED Section** - the FULL numbered list (1., 2., 3., etc.) - **THIS IS WHAT WE WANT**

**Protocol Preview (line-numbered sample):**
```
{preview_text}
```

**Total protocol lines:** {total_lines}

**Your Task:**
1. **Find the DETAILED inclusion/exclusion sections**:
   - Look for section HEADERS with various phrasings:
     * "X.X.X Inclusion Criteria" OR "X.X.X Subject Inclusion Criteria" OR "X.X.X Patient Inclusion Criteria"
     * "X.X.X Exclusion Criteria" OR "X.X.X Subject Exclusion Criteria" OR "X.X.X Patient Exclusion Criteria"
     * "X.X.X Eligibility Criteria" OR "X.X.X Entry Criteria"
     * Markdown format: "#### X.X.X Subject Inclusion Criteria" (where X.X.X is any section number like 5.1.2)
   - These usually appear LATER in protocol (often line 1000+), NOT in first 200 lines
   - **CRITICAL**: The word "Subject" or "Patient" may appear before "Inclusion/Exclusion"

2. **IGNORE false positives**:
   - ❌ TOC entries: "5.1.2     Subject Inclusion Criteria.......35" (dots leading to page number)
   - ❌ Summary sections: "Key Inclusion Criteria:" (brief, no detailed numbered list)

3. **CRITICAL: Find EXACT boundaries using line numbers from the preview**:

   **For Inclusion Criteria:**
   - START: EXACT line number where the Inclusion header appears (look for line with "X.X.X Subject Inclusion Criteria")
   - END: EXACT line number of the LAST LINE OF TEXT in the last criterion
     * Look for the last numbered criterion (e.g., "14. Subject has voluntarily agreed...")
     * Find the LAST line of text belonging to that criterion (could be multiple lines)
     * That last line of text is your END line
     * DO NOT stop at the line before - include the COMPLETE last criterion

   **For Exclusion Criteria:**
   - START: EXACT line number where the Exclusion header appears (look for line with "X.X.X Subject Exclusion Criteria")
   - END: EXACT line number of the LAST LINE OF TEXT in the last criterion
     * Look for the last numbered criterion (e.g., "21. Is or has an immediate family member...")
     * Find the LAST line of text belonging to that criterion
     * That last line of text is your END line
     * DO NOT stop early - include the COMPLETE last criterion

   **IMPORTANT: The END line must be the actual last line of content, NOT a blank line or section header!**

4. **Example boundary detection (GENERIC PATTERN - adapt to actual protocol):**
   ```
   Line N:   #### X.X.X  Inclusion Criteria        ← START inclusion
   Line N+1: Subjects must meet all of the following...
   ...
   Line M:   [Last line of inclusion criteria]
   Line M+1: [Blank line or separator]
   Line M+2: X.X.Y  Exclusion Criteria              ← START exclusion
   Line M+3: The subject must be excluded if...
   ...
   Line P:   [Last line of exclusion criteria]
   Line P+1: X.Y Trial Treatment / Study Design    ← Next section starts here
   ```

   So: Inclusion = lines N to M, Exclusion = lines (M+2) to P

   **Adapt section numbers and line numbers based on the ACTUAL protocol being analyzed**

5. **Return the ACTUAL line numbers from the protocol, not the example numbers above**

**Return JSON:**
{{
  "inclusion_section": {{
    "found": true/false,
    "start_line": <int>,  // Line where "5.1.2 Inclusion Criteria" header appears
    "end_line": <int>,    // Line BEFORE next section starts (e.g., line before "5.1.3")
    "section_header": "exact header text from protocol",
    "next_section_header": "text of the section that comes after" (helps verify boundary),
    "format_type": "numbered_list" or "table" or "paragraph",
    "has_cohorts": true/false,
    "confidence": 0.0-1.0
  }},
  "exclusion_section": {{
    "found": true/false,
    "start_line": <int>,  // Line where "5.1.3 Exclusion Criteria" header appears
    "end_line": <int>,    // Line BEFORE next section starts (e.g., line before "5.2")
    "section_header": "exact header text from protocol",
    "next_section_header": "text of the section that comes after",
    "format_type": "numbered_list" or "table" or "paragraph",
    "has_cohorts": true/false,
    "confidence": 0.0-1.0
  }},
  "cross_references_detected": [
    {{
      "target_section": "6.5.2",
      "purpose": "prohibited medications list",
      "mentioned_in": "inclusion" or "exclusion"
    }}
  ]
}}

**Example output format (use ACTUAL line numbers and headers from the protocol):**
{{
  "inclusion_section": {{
    "found": true,
    "start_line": <actual line number>,
    "end_line": <actual line number>,
    "section_header": "<exact header text from protocol>",
    "next_section_header": "<exact text of next section>",
    "format_type": "numbered_list" or "table" or "paragraph",
    "has_cohorts": true/false,
    "confidence": 0.0-1.0
  }},
  "exclusion_section": {{
    "found": true,
    "start_line": <actual line number>,
    "end_line": <actual line number>,
    "section_header": "<exact header text from protocol>",
    "next_section_header": "<exact text of next section>",
    "format_type": "numbered_list" or "table" or "paragraph",
    "has_cohorts": true/false,
    "confidence": 0.0-1.0
  }}
}}

**IMPORTANT:**
- Line numbers are 0-indexed (first line = 0)
- Be precise with boundaries - don't include unrelated content
- **PRIORITIZE detailed criteria sections over TOC/summary sections**
- If you find multiple matches, return the DETAILED one (typically later in document, with numbered list)
- Set confidence based on:
  - 0.95+ : Found detailed section with numbered criteria
  - 0.80-0.94 : Found section but might be summary
  - < 0.80 : Not confident / could not find
