You are a clinical informatics expert reviewing OMOP concept extraction for COMPLETENESS.

**CRITERION:**
Atomic Text: {atomic_text_safe}
Value Constraint: {value_constraint_safe}
Expected Domain: {expected_domain}

**EXTRACTED PRIMARY SEARCH TERMS:**
{primary_terms_json}

**CURRENTLY MAPPED CONCEPTS ({total_concepts} total, showing first 50):**
{current_concepts_json}

**YOUR TASK:**
Identify if any ESSENTIAL concepts are missing from the mapping.

**IMPORTANT:** Only consider PRIMARY TERMS listed above. Do NOT add concepts that are not directly mentioned or clearly implied by the primary terms.

**V42 FIX A7: CRITICAL CONSTRAINTS - DO NOT VIOLATE**
1. **NEVER suggest temporal qualifiers:** "active", "current", "recent", "prior", "ongoing", "acute", "chronic"
   - ❌ BAD: "Active tuberculosis" → TOO SPECIFIC (status qualifier)
   - ✅ GOOD: "Tuberculosis" → Let the base condition cover all variants
2. **NEVER suggest status qualifiers:** "controlled", "uncontrolled", "stable", "unstable", "well-controlled"
   - ❌ BAD: "Controlled diabetes" → RARELY CODIFIED
   - ✅ GOOD: "Diabetes mellitus" → Base condition only
3. **NEVER suggest severity modifiers UNLESS explicitly in PRIMARY TERMS:** "severe", "mild", "moderate"
   - ❌ BAD: "Severe anemia" (if primary term is just "anemia")
   - ✅ GOOD: "Severe anemia" (ONLY if primary term explicitly says "severe anemia")
4. **NEVER suggest broad categories:** "infection status", "disease activity", "treatment response"
   - These are almost never standard OMOP concepts

**SAFE TO SUGGEST:**
- Disease subtypes mentioned in primary terms: "small cell lung cancer", "rheumatoid arthritis"
- Body sites mentioned in criterion: "left ventricle", "bilateral lungs"
- Lab test components explicitly mentioned: "hemoglobin A1c", "serum creatinine"
- Specific drugs mentioned in primary terms: "pembrolizumab", "metformin"

**V48 UPDATED RULES (MAXIMUM 3 CONCEPTS):**
1. Only flag ESSENTIAL missing concepts (not nice-to-have edge cases)
2. Missing concept must be directly mentioned in PRIMARY TERMS or clearly implied by the criterion text
3. Check if each primary term is actually represented in the final concepts (either exact match or close synonym)
4. **PREFER GENERAL CONCEPTS OVER SUBTYPES:**
   - ✅ GOOD: "Multiple myeloma" (general)
   - ❌ BAD: "Multiple myeloma in remission", "Relapsed multiple myeloma" (subtypes)
5. Be EXTREMELY CONSERVATIVE - only add CRITICAL missing concepts
6. **MAXIMUM 3 CONCEPTS TOTAL** (down from 5 in V47)
7. **When in doubt, DON'T suggest it** - false negatives are better than false positives

**DECISION EXAMPLES:**

Example 1: PRIMARY TERM MISSING
Primary Terms: ["Fuchs endothelial corneal dystrophy", "keratoconus", "corneal ulcer"]
Current Concepts: ["Keratoconus", "Acute keratoconus", "Corneal ulcer", "Bacterial corneal ulcer", ...]
Analysis: "Fuchs endothelial corneal dystrophy" is a PRIMARY term but NOT in current concepts
→ MISSING: Add it with search pattern "%Fuchs%dystrophy%"

Example 2: TERM REPRESENTED BY SYNONYM (NOT MISSING)
Primary Terms: ["myocardial infarction", "heart attack"]
Current Concepts: ["Acute myocardial infarction", "ST elevation MI", "Non-ST elevation MI", ...]
Analysis: "heart attack" is synonym for "myocardial infarction" which IS represented
→ NOT MISSING: Adequately covered

Example 3: DRUG CLASS WITH SPECIFIC AGENTS IN PRIMARY TERMS
Primary Terms: ["antihistamine therapy", "loratadine", "cetirizine", "diphenhydramine"]
Current Concepts: ["Loratadine", "Cetirizine", "Fexofenadine"]
Analysis: Primary term "diphenhydramine" is explicitly listed but not in concepts
→ MISSING: Add it (explicitly mentioned in primary terms)

Example 4: COMPLETE COVERAGE (NOTHING MISSING)
Primary Terms: ["non-small cell lung cancer", "NSCLC"]
Current Concepts: ["Adenocarcinoma of lung", "Squamous cell carcinoma", "Large cell carcinoma", "NSCLC stage 1", ...]
Analysis: All major NSCLC subtypes are represented
→ NOT MISSING: Complete coverage

**SEARCH PATTERN RULES (V52.6):**
1. **Use FULL WORDS - never truncate suffixes**
   - ✅ GOOD: "%refractory%disease%" (keeps 'y' suffix)
   - ❌ BAD: "%refractor%" (truncated - matches optical devices)
2. **Minimum 5 characters per word segment** (after removing %)
   - ✅ GOOD: "%diabetes%mellitus%" (8 chars + 8 chars)
   - ❌ BAD: "%diab%" (4 chars - too short)
3. **Keep common suffixes:** 'y', 'ed', 'ing', 'al', 'ous', 'ion'
   - ✅ GOOD: "%infection%", "%inflammatory%", "%chronic%"
   - ❌ BAD: "%infect%", "%inflammat%", "%chron%"
4. **Use multiple words for specificity**
   - ✅ GOOD: "%refractory%disease%", "%uncontrolled%hypertension%"
   - ⚠️  OK: "%refractory%" (acceptable if contextual)
   - ❌ BAD: "%refract%" (ambiguous - could be optical)

**PATTERN EXAMPLES:**
- Disease: "%myocardial%infarction%", "%type%diabetes%"
- Treatment: "%refractory%therapy%", "%resistant%infection%"
- Lab: "%hemoglobin%A1c%", "%serum%creatinine%"
- Anatomy: "%left%ventricle%", "%anterior%wall%"

**OUTPUT JSON:**
{{
  "has_missing_concepts": true | false,
  "confidence": 0.0-1.0,
  "missing_concepts": [
    {{
      "term": "exact medical term that is missing",
      "reason": "why this is essential (cite primary/secondary term or criterion text)",
      "search_pattern": "OMOP LIKE pattern (e.g., '%refractory%disease%' - FULL WORDS ONLY)",
      "priority": "critical" | "important"
    }}
  ],
  "reasoning": "overall assessment of completeness with justification"
}}

IMPORTANT:
- Maximum 5 missing concepts
- Only include priority "critical" or "important"
- If confidence < 0.7, set has_missing_concepts to false