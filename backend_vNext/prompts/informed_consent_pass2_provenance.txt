system
You are an expert clinical trial document analyst specializing in locating exact source references in clinical protocol documents.

user
# INFORMED CONSENT ELEMENTS - PASS 2: PROVENANCE EXTRACTION

## OBJECTIVE
Add provenance (source references) to ALL values extracted in Pass 1. For EVERY extracted element, locate the supporting evidence in the protocol and add provenance.

You are provided with:
1. Extracted informed consent elements from Pass 1
2. The original protocol PDF

Your task is to find EXACT source locations (provenance) for each extracted item.

---

## CRITICAL: 100% PROVENANCE COVERAGE REQUIRED

**EVERY section MUST have provenance coverage.** Provenance coverage means:
- The object has a `provenance` object with page_number and text_snippet

**FAILURE MODE**: If ANY section is missing a `provenance` object, the quality check FAILS.

**MANDATORY PROVENANCE OBJECTS** - You MUST add `provenance` to ALL these paths:
- `$.provenance` - Root document provenance (REQUIRED)
- `$.study_overview.provenance` (REQUIRED)
- `$.study_procedures.provenance` (REQUIRED)
- `$.risks.provenance` (REQUIRED)
- `$.benefits.provenance` (REQUIRED)
- `$.alternatives.provenance` (REQUIRED)
- `$.compensation_costs.provenance` (REQUIRED)
- `$.confidentiality.provenance` (REQUIRED)
- `$.voluntary_participation.provenance` (REQUIRED)
- `$.special_consents.provenance` (REQUIRED)
- `$.contacts.provenance` (REQUIRED)
- `$.reproductive_requirements.provenance` (REQUIRED)

---

## PROVENANCE STRUCTURE

For each provenance object, provide:
```json
{
  "section_number": "6.5",
  "page_number": 85,
  "text_snippet": "Direct quote from protocol (max 500 chars)"
}
```

- **section_number**: SHORT section number ONLY (e.g., "5", "6.5", "8.2"). MAX 20 characters. Can be null if unknown.
- **page_number**: PDF page number (integer, 1-indexed) - REQUIRED
- **text_snippet**: Direct quote from protocol (STRICT MAX 500 chars). Truncate with "..." if longer. - REQUIRED

---

## PASS 1 EXTRACTION (Data Requiring Provenance)

{{ extracted_values }}

---

## PROVENANCE PATHS TO POPULATE

**Root Level:**
- $.provenance

**Study Overview:**
- $.study_overview.provenance

**Study Procedures:**
- $.study_procedures.provenance
- $.study_procedures.screening_procedures[*].provenance (EACH procedure)
- $.study_procedures.treatment_procedures[*].provenance (EACH procedure)
- $.study_procedures.follow_up_procedures[*].provenance (EACH procedure)
- $.study_procedures.optional_procedures[*].provenance (EACH procedure)

**Risks:**
- $.risks.provenance
- $.risks.known_risks[*].provenance (EACH risk item)

**Benefits:**
- $.benefits.provenance

**Alternatives:**
- $.alternatives.provenance

**Compensation and Costs:**
- $.compensation_costs.provenance

**Confidentiality:**
- $.confidentiality.provenance

**Voluntary Participation:**
- $.voluntary_participation.provenance

**Special Consents:**
- $.special_consents.provenance
- $.special_consents.genetic_testing.provenance (if present)
- $.special_consents.biobanking.provenance (if present)
- $.special_consents.photography_recording.provenance (if present)

**Contacts:**
- $.contacts.provenance

**Reproductive Requirements:**
- $.reproductive_requirements.provenance

---

## SEARCH STRATEGY

| Content Type | Typical Sections |
|--------------|------------------|
| Study Purpose/Overview | 1, 2, 3 (Synopsis, Introduction, Objectives) |
| Study Procedures | 7, 8 (Assessments, Schedule of Activities) |
| Known Risks | 6.5, 6.6, 13 (Safety, Toxicity, Adverse Events) |
| Benefits | 1, 2, 3 (Background, Rationale) |
| Alternatives | 1, 2 (Introduction, Background) |
| Compensation | 11, Appendix (Ethical, Administrative) |
| Confidentiality | 11, 12 (Data Handling, Privacy) |
| Withdrawal | 5, 7 (Discontinuation, Subject Withdrawal) |
| Genetic/Biobanking | 8, 10, Appendix (Exploratory, Biomarkers) |
| Pregnancy/Contraception | 5.1 (Eligibility), 6.5 (Safety) |
| Contacts | 11, 14 (Administrative, References) |

---

## TEXT SNIPPET RULES

1. **EXACT QUOTE**: Copy text exactly as it appears
2. **STRICT MAX 500 CHARACTERS**: If text exceeds 500 chars, TRUNCATE with "..." IMMEDIATELY
3. **MOST RELEVANT PORTION**: Select the SHORTEST phrase that directly supports the value
4. **CLEAN WHITESPACE**: Remove excess line breaks, collapse multiple spaces

---

## CRITICAL: DO NOT MODIFY PRIMITIVE ARRAYS

**Arrays that must remain as PLAIN STRING arrays:**
- `potential_risks`: ["Risk 1", "Risk 2"] ← KEEP AS PLAIN STRINGS
- `potential_benefits`: ["Benefit 1"] ← KEEP AS PLAIN STRINGS
- `participant_costs`: ["Cost 1"] ← KEEP AS PLAIN STRINGS
- `covered_costs`: ["Study drug"] ← KEEP AS PLAIN STRINGS
- `who_has_access`: ["FDA", "IRB"] ← KEEP AS PLAIN STRINGS

**WRONG** (Do NOT do this):
```json
"potential_benefits": [
  {"value": "May improve condition", "provenance": {...}}  // WRONG!
]
```

**CORRECT** (Do this instead):
```json
"potential_benefits": ["May improve condition"],  // CORRECT - plain strings
"provenance": { ... }  // Provenance at PARENT object level only
```

---

## CRITICAL PAGE NUMBER RULES

1. Use PHYSICAL page numbers (1st page of PDF = 1)
2. Do NOT use printed page numbers in headers/footers
3. The text_snippet MUST appear on the EXACT page_number you specify

---

## OUTPUT FORMAT

Return the COMPLETE Pass 1 JSON with provenance added to ALL locations listed above.

Example structure:
```json
{
  "id": "PROTOCOL_ID-informed-consent",
  "instanceType": "InformedConsentElements",
  "name": "PROTOCOL_ID Informed Consent Elements",

  "study_overview": {
    "study_purpose": "To evaluate efficacy and safety of Drug X",
    "study_duration_for_participant": "24 months",
    "number_of_visits": 25,
    "provenance": {
      "section_number": "1",
      "page_number": 15,
      "text_snippet": "This Phase 3 study evaluates the efficacy and safety of Drug X..."
    }
  },

  "risks": {
    "known_risks": [
      {
        "risk_id": "RISK-001",
        "risk_description": "Nausea and vomiting",
        "severity": "moderate",
        "frequency": "common",
        "provenance": {
          "section_number": "6.5",
          "page_number": 85,
          "text_snippet": "Common adverse reactions (>10%) include nausea and vomiting..."
        }
      }
    ],
    "potential_risks": ["Unknown long-term effects"],
    "provenance": {
      "section_number": "6.5",
      "page_number": 85,
      "text_snippet": "SAFETY CONSIDERATIONS"
    }
  },

  "benefits": {
    "potential_benefits": ["May slow disease progression"],
    "no_benefit_statement": "You may not benefit directly",
    "provenance": {
      "section_number": "2",
      "page_number": 25,
      "text_snippet": "Drug X has shown potential to slow disease progression in early studies..."
    }
  },

  "provenance": {
    "section_number": "1",
    "page_number": 15,
    "text_snippet": "PROTOCOL SYNOPSIS"
  }
}
```

---

## VALIDATION CHECKLIST (MANDATORY)

**Before returning, verify ALL of these provenance objects exist:**

Root Level:
- [ ] `$.provenance` exists with page_number and text_snippet

Section Level (ALL 11 REQUIRED):
- [ ] `$.study_overview.provenance` exists
- [ ] `$.study_procedures.provenance` exists
- [ ] `$.risks.provenance` exists
- [ ] `$.benefits.provenance` exists
- [ ] `$.alternatives.provenance` exists
- [ ] `$.compensation_costs.provenance` exists
- [ ] `$.confidentiality.provenance` exists
- [ ] `$.voluntary_participation.provenance` exists
- [ ] `$.special_consents.provenance` exists
- [ ] `$.contacts.provenance` exists
- [ ] `$.reproductive_requirements.provenance` exists

Array Items:
- [ ] Every item in `screening_procedures[]` has provenance
- [ ] Every item in `treatment_procedures[]` has provenance
- [ ] Every item in `follow_up_procedures[]` has provenance
- [ ] Every item in `known_risks[]` has provenance

Special Consents (if present):
- [ ] `$.special_consents.genetic_testing.provenance` exists (if genetic_testing is not null)
- [ ] `$.special_consents.biobanking.provenance` exists (if biobanking is not null)

Format Requirements:
- [ ] All page_number values are integers (1-indexed)
- [ ] All text_snippets are ≤500 characters
- [ ] text_snippets are EXACT quotes from the document
- [ ] Primitive arrays remain as plain strings

**DO NOT RETURN until ALL checkboxes above are satisfied.**

---

## OUTPUT

Return ONLY valid JSON. No markdown fences, no explanations.
Return the complete merged JSON object with all Pass 1 data PLUS provenance for EVERY section.
