# BIOSPECIMEN HANDLING EXTRACTION - PASS 2: PROVENANCE ONLY
# Purpose: Add source location provenance to previously extracted values
# CRITICAL: This is Pass 2 - add PROVENANCE ONLY. NEVER modify or rename any extracted values.

You are adding provenance (source location) information to biospecimen handling data that was extracted in Pass 1. Your task is to find where each piece of data appears in the source document.

## CRITICAL RULES - READ CAREFULLY

### Rule 1: PRESERVE ALL EXISTING FIELDS EXACTLY
- DO NOT rename any fields (e.g., keep `timepoint_name`, NOT `timepoint`)
- DO NOT remove any fields (e.g., keep `schedule_id`, `specimen_id`, etc.)
- DO NOT change any values from Pass 1
- The structure from Pass 1 MUST remain exactly the same

### Rule 2: ADD ONLY A SINGLE `provenance` OBJECT PER ITEM
For each array item (discovered_specimen_types, collection_schedule, etc.), add ONLY ONE `provenance` object:

```json
{
  "specimen_id": "SPEC-001",          // KEEP - do not remove
  "specimen_name": "Serum for PK",    // KEEP - do not remove
  "specimen_category": "blood",       // KEEP - do not remove
  "specimen_subtype": "serum",        // KEEP - do not remove
  "purpose": "pk",                    // KEEP - do not remove
  "purpose_description": "...",       // KEEP - do not remove
  "provenance": {                     // ADD THIS - single provenance object
    "section_number": "5.3.1",
    "page_number": 42,
    "text_snippet": "Serum samples will be collected..."
  }
}
```

### Rule 3: DO NOT CREATE FIELD-LEVEL PROVENANCE
WRONG - Do NOT do this:
```json
{
  "specimen_name": "Serum",
  "specimen_name_provenance": { ... },  // WRONG!
  "specimen_category": "blood",
  "specimen_category_provenance": { ... }  // WRONG!
}
```

CORRECT - Do this instead:
```json
{
  "specimen_name": "Serum",
  "specimen_category": "blood",
  "provenance": { ... }  // ONE provenance object for the whole item
}
```

## PROVENANCE STRUCTURE

The `provenance` object has exactly three fields:
- `section_number`: String or null - Section number where found (e.g., "5.3.1", "Table 1.1")
- `page_number`: Integer or null - PDF page number (1-indexed)
- `text_snippet`: String or null - Direct quote (max 500 chars)

## COMPLETE INPUT/OUTPUT EXAMPLE

### INPUT (from Pass 1):
```json
{
  "collection_schedule": [
    {
      "schedule_id": "COL-001",
      "specimen_ref": "SPEC-001",
      "timepoint_name": "Screening",
      "timepoint_type": "screening",
      "relative_time": "Day -28 to Day -1",
      "collection_window": {
        "value": 28,
        "unit": "days",
        "description": "28 days before Day 1"
      },
      "number_of_samples": 1,
      "fasting_required": false
    }
  ]
}
```

### OUTPUT (with provenance added):
```json
{
  "collection_schedule": [
    {
      "schedule_id": "COL-001",
      "specimen_ref": "SPEC-001",
      "timepoint_name": "Screening",
      "timepoint_type": "screening",
      "relative_time": "Day -28 to Day -1",
      "collection_window": {
        "value": 28,
        "unit": "days",
        "description": "28 days before Day 1"
      },
      "number_of_samples": 1,
      "fasting_required": false,
      "provenance": {
        "section_number": "Table 1.1",
        "page_number": 35,
        "text_snippet": "Blood samples for PK analysis will be collected during Screening (Day -28 to Day -1)..."
      }
    }
  ]
}
```

## WHERE TO ADD PROVENANCE

Add a `provenance` object to each item in these arrays:
1. `discovered_specimen_types[]` - each specimen type
2. `collection_containers[]` - each container
3. `collection_schedule[]` - each collection timepoint
4. `processing_requirements[]` - each processing step
5. `storage_requirements[]` - each storage condition
6. `shipping_requirements[]` - each shipping specification

Add a `provenance` object to these objects (if present):
7. `central_laboratory`
8. `kit_specifications`
9. `quality_requirements`
10. `regulatory_requirements`
11. `volume_summary`

**Biomedical Concepts:**
Note: biomedicalConcept objects do NOT require separate provenance. They inherit provenance from their parent specimen type object.

## PROVENANCE QUALITY RULES

### Finding the Right Source
- Find the MOST SPECIFIC section where the information is defined
- Prefer: Section 5.3.1 "Sample Collection" over Section 1.2 "Overview"
- Find where the item is DEFINED, not just mentioned

### Text Snippet Requirements
- MUST be an EXACT quote from the document (no paraphrasing)
- Maximum 500 characters
- Include enough context to understand the value
- If longer, truncate and end with "..."

### If Provenance Cannot Be Found
```json
{
  "provenance": {
    "section_number": null,
    "page_number": null,
    "text_snippet": null
  }
}
```

## VALIDATION CHECKLIST (MANDATORY)

**Before returning, verify ALL of these provenance objects exist:**

Root Level:
- [ ] `$.provenance` exists with page_number and text_snippet (if applicable)

Array Items:
- [ ] Every item in `discovered_specimen_types[]` has provenance
- [ ] Every item in `collection_containers[]` has provenance
- [ ] Every item in `collection_schedule[]` has provenance
- [ ] Every item in `processing_requirements[]` has provenance
- [ ] Every item in `storage_requirements[]` has provenance
- [ ] Every item in `shipping_requirements[]` has provenance

Optional Sections (if present and not null):
- [ ] `$.central_laboratory.provenance` exists
- [ ] `$.kit_specifications.provenance` exists
- [ ] `$.quality_requirements.provenance` exists
- [ ] `$.regulatory_requirements.provenance` exists
- [ ] `$.volume_summary.provenance` exists

Format Requirements:
- [ ] ALL original fields from Pass 1 are present (schedule_id, timepoint_name, etc.)
- [ ] NO field names were changed
- [ ] NO values were modified
- [ ] Each array item has exactly ONE `provenance` object
- [ ] NO `*_provenance` fields exist (like `specimen_name_provenance`)
- [ ] All text_snippets are â‰¤500 characters
- [ ] All page_numbers are positive integers (1-indexed)

**DO NOT RETURN until ALL checkboxes above are satisfied.**

## REMEMBER

This is PASS 2 - PROVENANCE ONLY.
- NEVER change field names from Pass 1
- NEVER remove fields from Pass 1
- NEVER modify values from Pass 1
- ONLY add a single `provenance` object to each item
- Return the COMPLETE object with structure preserved
