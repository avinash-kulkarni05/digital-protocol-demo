system
You are an expert at finding source locations in clinical protocol and SAP documents. Your task is to provide precise provenance for extracted endpoints, estimands, objectives, populations, and statistical analyses.

user
# ENDPOINTS, ESTIMANDS & SAP - PASS 2: PROVENANCE EXTRACTION

## OBJECTIVE
Add provenance (source references) to ALL values extracted in Pass 1. For EVERY extracted element, locate the supporting evidence in the document and add provenance.

You have the PDF document available. Search through it to find the EXACT source location for each extracted value.

---

## PROVENANCE STRUCTURE

For each provenance object, provide:
```json
{
  "section_number": "3.1",
  "page_number": 28,
  "text_snippet": "Direct quote from document (max 500 chars)"
}
```

- **section_number**: Exact section from document (e.g., "3.1", "4.1", "10.2")
- **page_number**: PHYSICAL PDF page number (integer, 1-indexed)
- **text_snippet**: Direct quote from document (max 500 chars)

---

## PASS 1 EXTRACTION (Data Requiring Provenance)

{{ extracted_data }}

---

## PROVENANCE PATHS TO POPULATE

### DOMAIN 1: PROTOCOL ENDPOINTS

**Root Level:**
- $.protocol_endpoints.provenance

**Objectives:**
- $.protocol_endpoints.objectives[*].provenance (EACH objective)

**Endpoints:**
- $.protocol_endpoints.endpoints[*].provenance (EACH endpoint)

**Estimands:**
- $.protocol_endpoints.estimands[*].provenance (EACH estimand)
- $.protocol_endpoints.estimands[*].treatment.provenance (treatment comparison)
- $.protocol_endpoints.estimands[*].population.provenance (population definition)
- $.protocol_endpoints.estimands[*].variable.provenance (variable definition)
- $.protocol_endpoints.estimands[*].intercurrent_events[*].provenance (EACH ICE)

**Analysis Populations:**
- $.protocol_endpoints.analysis_populations[*].provenance (EACH population)

### DOMAIN 2: SAP ANALYSES

**Root Level:**
- $.sap_analyses.provenance

**Sensitivity Analyses:**
- $.sap_analyses.sensitivity_analyses[*].provenance (EACH analysis)

**Statistical Methods:**
- $.sap_analyses.statistical_methods[*].provenance (EACH method)

**Subgroup Analyses:**
- $.sap_analyses.subgroup_analyses[*].provenance (EACH subgroup)

**Multiplicity Adjustment:**
- $.sap_analyses.multiplicity_adjustment.provenance

**Missing Data Handling:**
- $.sap_analyses.missing_data_handling.provenance

**Overall Provenance:**
- $.provenance (root level)

---

## ICH M11 SECTION MAPPING

Use these standard section numbers for ICH M11 compliant protocols:

| Content Type | ICH M11 Section |
|-------------|-----------------|
| Primary Objectives | 3.1 |
| Secondary Objectives | 3.2 |
| Exploratory Objectives | 3.3 |
| Primary Endpoints | 4.1 |
| Secondary Endpoints | 4.2 |
| Exploratory Endpoints | 4.3 |
| Safety Endpoints | 4.4 |
| Estimands | 4.5 |
| Analysis Populations | 10.1 |
| Statistical Methods | 10.2 |
| Intercurrent Events | 10.3 |
| Missing Data | 10.4 |
| Sensitivity Analyses | 10.5 |
| Subgroup Analyses | 10.6 |

---

## SEARCH STRATEGIES

### For Protocol Endpoints
| Content Type | Typical Sections |
|--------------|------------------|
| Objectives | 3.x, Synopsis |
| Endpoints | 4.x, Efficacy Assessments |
| Estimands | 4.5, 10.x, Statistics |
| Populations | 10.1, Statistics section |
| ICE Strategies | 10.3, Statistics section |

### For SAP Analyses
| Content Type | Typical Sections |
|--------------|------------------|
| Sensitivity Analyses | 10.x, SAP specific sections |
| Statistical Methods | 10.2, Analysis Methods |
| Subgroup Analyses | 10.6, Subgroups section |
| Multiplicity | 10.4, Alpha allocation |
| Missing Data | 10.4, Missing Data section |

---

## CRITICAL: DO NOT MODIFY PRIMITIVE ARRAYS

**IMPORTANT**: The following array fields contain PLAIN STRINGS. Do NOT convert them to objects with value/provenance.

**Arrays that must remain as PLAIN STRING arrays:**
- `strategies`: ["treatment_policy", "composite"] ← KEEP AS PLAIN STRINGS
- `subgroup_variables`: ["age", "sex", "region"] ← KEEP AS PLAIN STRINGS
- `covariates`: ["baseline_score", "stratification_factor"] ← KEEP AS PLAIN STRINGS
- `alpha_allocation`: ["0.025 two-sided", "0.05 one-sided"] ← KEEP AS PLAIN STRINGS

**WRONG** (Do NOT do this):
```json
"subgroup_variables": [
  {"value": "age", "provenance": {...}},
  {"value": "sex", "provenance": {...}}
]
```

**CORRECT** (Do this instead):
```json
"subgroup_variables": ["age", "sex", "region"],
"provenance": {
  "section_number": "10.6",
  "page_number": 92,
  "text_snippet": "Subgroup analyses will be performed for age, sex, and region..."
}
```

Provenance goes at the PARENT OBJECT level, covering all fields within that object including string arrays.

---

## CRITICAL PAGE NUMBER RULES

1. Use PHYSICAL page numbers (1st page of PDF = 1)
2. Do NOT use printed page numbers in headers/footers
3. The text_snippet MUST appear on the EXACT page_number you specify
4. Your provenance will be VERIFIED against the source PDF

---

## TEXT SNIPPET RULES

1. **EXACT QUOTE**: Copy text exactly as it appears
2. **MAX 500 CHARACTERS**: Truncate with "..." if longer
3. **TRUNCATE IF NEEDED**: Add "..." at end if truncating
4. **MOST RELEVANT PORTION**: Select phrase that directly supports the value
5. **SINGLE PAGE**: Each snippet must appear entirely on the cited page

---

## OUTPUT FORMAT

Return the COMPLETE Pass 1 JSON with provenance added to ALL locations listed above.

Example structure:
```json
{
  "id": "PROTOCOL_ID-endpoints-estimands-sap",
  "instanceType": "EndpointsEstimandsSAP",

  "protocol_endpoints": {
    "objectives": [
      {
        "id": "objective-001",
        "name": "Primary Efficacy Objective",
        "provenance": {
          "section_number": "3.1",
          "page_number": 28,
          "text_snippet": "Primary Objective: To evaluate the efficacy of Drug X compared with docetaxel as measured by..."
        }
      }
    ],
    "endpoints": [
      {
        "id": "endpoint-001",
        "name": "ORR by RECIST 1.1",
        "provenance": {
          "section_number": "4.1",
          "page_number": 45,
          "text_snippet": "Primary Endpoint: The primary efficacy endpoint is objective response rate (ORR), defined as..."
        }
      }
    ],
    "estimands": [
      {
        "id": "estimand-001",
        "provenance": {
          "section_number": "4.5",
          "page_number": 52,
          "text_snippet": "The primary estimand is defined for the ITT population, comparing Drug X versus..."
        },
        "treatment": {
          "provenance": {
            "section_number": "6.1",
            "page_number": 58,
            "text_snippet": "Drug X will be administered at 6 mg/kg as an IV infusion..."
          }
        },
        "population": {
          "provenance": {
            "section_number": "10.1",
            "page_number": 78,
            "text_snippet": "The ITT Population will consist of all randomized subjects..."
          }
        },
        "variable": {
          "provenance": {
            "section_number": "4.1",
            "page_number": 45,
            "text_snippet": "ORR is defined as the proportion of subjects with best overall response of CR or PR..."
          }
        },
        "intercurrent_events": [
          {
            "id": "ice-001",
            "provenance": {
              "section_number": "10.3",
              "page_number": 85,
              "text_snippet": "For subjects who discontinue study treatment, efficacy assessments will continue..."
            }
          }
        ]
      }
    ],
    "analysis_populations": [
      {
        "id": "population-001",
        "provenance": {
          "section_number": "10.1",
          "page_number": 78,
          "text_snippet": "The Intent-to-Treat (ITT) Population includes all randomized subjects..."
        }
      }
    ],
    "provenance": {
      "section_number": "3",
      "page_number": 28,
      "text_snippet": "OBJECTIVES AND ENDPOINTS"
    }
  },

  "sap_analyses": {
    "sensitivity_analyses": [
      {
        "id": "sens-001",
        "provenance": {
          "section_number": "10.5",
          "page_number": 88,
          "text_snippet": "Sensitivity analysis will repeat the primary analysis in the Per-Protocol population..."
        }
      }
    ],
    "statistical_methods": [
      {
        "id": "method-001",
        "provenance": {
          "section_number": "10.2",
          "page_number": 80,
          "text_snippet": "The primary analysis will use Cochran-Mantel-Haenszel test stratified by region..."
        }
      }
    ],
    "subgroup_analyses": [
      {
        "id": "subgroup-001",
        "provenance": {
          "section_number": "10.6",
          "page_number": 92,
          "text_snippet": "Subgroup analyses will be performed for age (<65 vs >=65), sex, and prior therapy..."
        }
      }
    ],
    "multiplicity_adjustment": {
      "method": "Fixed Sequence",
      "provenance": {
        "section_number": "10.4.1",
        "page_number": 85,
        "text_snippet": "A fixed sequence testing procedure will be used to control the overall Type I error..."
      }
    },
    "missing_data_handling": {
      "primary_method": "MMRM",
      "provenance": {
        "section_number": "10.4.2",
        "page_number": 86,
        "text_snippet": "Mixed-model repeated measures (MMRM) will be used as the primary analysis method..."
      }
    },
    "provenance": {
      "section_number": "10",
      "page_number": 75,
      "text_snippet": "STATISTICAL ANALYSIS PLAN"
    }
  },

  "provenance": {
    "section_number": "3-10",
    "page_number": 28,
    "text_snippet": "Study objectives, endpoints, and statistical analysis methodology..."
  }
}
```

---

## VALIDATION

Before returning:
- Every applicable location has a provenance object
- All page_number values are integers
- All text_snippets are ≤500 characters
- text_snippets are EXACT quotes from the document
- No values were modified from Pass 1
- Root provenance is present

Return ONLY valid JSON. No markdown fences.
