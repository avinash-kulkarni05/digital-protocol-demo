system
You are an expert clinical trial document analyst specializing in locating exact source references in clinical protocol documents.

user
# SAFETY DECISION POINTS - PASS 2: PROVENANCE EXTRACTION

## OBJECTIVE
Add provenance (source references) to ALL values extracted in Pass 1. For EVERY extracted element, locate the supporting evidence in the protocol and add provenance.

You are provided with:
1. Extracted safety decision points data from Pass 1
2. The original protocol PDF

Your task is to find EXACT source locations (provenance) for each extracted item.

---

## PROVENANCE STRUCTURE

For each provenance object, provide:
```json
{
  "section_number": "5.2.1",
  "page_number": 45,
  "text_snippet": "Direct quote from protocol (max 500 chars)"
}
```

- **section_number**: Exact section from protocol (e.g., "5.2", "6.1.3") - can be null if unknown
- **page_number**: PDF page number (integer, 1-indexed) - REQUIRED
- **text_snippet**: Direct quote from protocol (max 500 chars, truncate with "...") - REQUIRED

---

## PASS 1 EXTRACTION (Data Requiring Provenance)

{{ extracted_values }}

---

## PROVENANCE PATHS TO POPULATE

**Root Level:**
- $.provenance

**Discovered Categories:**
- $.discovered_categories[*].provenance (EACH category)

**Decision Points:**
- $.decision_points[*].provenance (EACH decision point)
- $.decision_points[*].decision_rules[*].provenance (EACH rule)

**Stopping Rules:**
- $.stopping_rules_summary.provenance
- $.stopping_rules_summary.stopping_conditions[*].provenance (EACH condition)

**Dose Modification Levels:**
- $.dose_modification_levels.provenance
- $.dose_modification_levels.levels[*].provenance (EACH level)

**Organ-Specific Adjustments:**
- $.organ_specific_adjustments[*].provenance (EACH adjustment)

---

## SEARCH STRATEGY

| Content Type | Typical Sections |
|--------------|------------------|
| Dose Modifications | 5.x, 6.x, "Dose Adjustments", "Safety Management" |
| Stopping Rules | 5.x, "Discontinuation Criteria", "Stopping Rules" |
| Dose Levels | Tables in "Dose Modifications" |
| Organ Adjustments | "Special Populations", "Dose Modifications" |
| Safety Parameters | 8.x, "Safety Assessments" |
| Toxicity Management | 6.x, "Toxicity Management" |

---

## TEXT SNIPPET RULES

1. **EXACT QUOTE**: Copy text exactly as it appears
2. **MAX 500 CHARACTERS**: Truncate with "..." if longer
3. **MOST RELEVANT PORTION**: Select phrase that directly supports the value
4. **CLEAN WHITESPACE**: Remove excess line breaks

---

## CRITICAL PAGE NUMBER RULES

1. Use PHYSICAL page numbers (1st page of PDF = 1)
2. Do NOT use printed page numbers in headers/footers
3. The text_snippet MUST appear on the EXACT page_number you specify

---

## OUTPUT FORMAT

Return the COMPLETE Pass 1 JSON with provenance added to ALL locations listed above.

Example structure:
```json
{
  "id": "PROTOCOL_ID-safety-decision-points",
  "instanceType": "SafetyDecisionPoints",
  "name": "PROTOCOL_ID Safety Decision Points",

  "discovered_categories": [
    {
      "category_id": "cat-001",
      "category_name": "Hematologic Toxicity",
      "provenance": {
        "section_number": "6.1",
        "page_number": 52,
        "text_snippet": "Hematologic toxicity including neutropenia..."
      }
    }
  ],

  "decision_points": [
    {
      "id": "dp-001",
      "parameter_name": "Neutrophil Count",
      "decision_rules": [
        {
          "rule_id": "dp-001-r1",
          "rule_description": "Hold for Grade 3-4 neutropenia",
          "provenance": {
            "section_number": "6.1.1",
            "page_number": 53,
            "text_snippet": "For Grade 3-4 neutropenia, hold study drug..."
          }
        }
      ],
      "provenance": {
        "section_number": "6.1",
        "page_number": 52,
        "text_snippet": "Neutrophil count must be monitored weekly..."
      }
    }
  ],

  "stopping_rules_summary": {
    "stopping_conditions": [
      {
        "condition_id": "stop-001",
        "description": "Recurrent Grade 4 toxicity",
        "provenance": {
          "section_number": "5.5",
          "page_number": 48,
          "text_snippet": "Subjects experiencing recurrent Grade 4..."
        }
      }
    ],
    "provenance": {
      "section_number": "5.5",
      "page_number": 48,
      "text_snippet": "Treatment Discontinuation Criteria"
    }
  },

  "dose_modification_levels": {
    "levels": [
      {
        "level_id": "dose-0",
        "level_name": "Starting Dose",
        "provenance": {
          "section_number": "6.2",
          "page_number": 55,
          "text_snippet": "Starting dose: 200 mg twice daily"
        }
      }
    ],
    "provenance": {
      "section_number": "6.2",
      "page_number": 55,
      "text_snippet": "Dose Modification Levels"
    }
  },

  "organ_specific_adjustments": [
    {
      "id": "organ-001",
      "organ_system": "Hepatic",
      "provenance": {
        "section_number": "6.3.1",
        "page_number": 58,
        "text_snippet": "For hepatic impairment, reduce dose..."
      }
    }
  ],

  "extraction_statistics": {...},

  "provenance": {
    "section_number": "6",
    "page_number": 50,
    "text_snippet": "DOSE MODIFICATIONS AND SAFETY MANAGEMENT"
  }
}
```

---

## VALIDATION CHECKLIST (MANDATORY)

**Before returning, verify ALL of these provenance objects exist:**

Root Level:
- [ ] `$.provenance` exists with page_number and text_snippet

Section Level:
- [ ] `$.stopping_rules_summary.provenance` exists (if not null)
- [ ] `$.dose_modification_levels.provenance` exists (if not null)

Array Items:
- [ ] Every item in `discovered_categories[]` has provenance
- [ ] Every item in `decision_points[]` has provenance
- [ ] Every item in `decision_points[*].decision_rules[]` has provenance
- [ ] Every item in `stopping_rules_summary.stopping_conditions[]` has provenance (if applicable)
- [ ] Every item in `dose_modification_levels.levels[]` has provenance (if applicable)
- [ ] Every item in `organ_specific_adjustments[]` has provenance

Format Requirements:
- [ ] All page_number values are integers (1-indexed)
- [ ] All text_snippets are â‰¤500 characters
- [ ] text_snippets are EXACT quotes from the document
- [ ] No values were modified from Pass 1

**DO NOT RETURN until ALL checkboxes above are satisfied.**

Return ONLY valid JSON. No markdown fences.
