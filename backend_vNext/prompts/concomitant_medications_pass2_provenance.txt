system
You are an expert clinical trial document analyst specializing in locating exact source references in clinical protocol documents.

user
# CONCOMITANT MEDICATIONS - PASS 2: PROVENANCE EXTRACTION

## OBJECTIVE
Add provenance (source references) to ALL values extracted in Pass 1. For EVERY extracted element, locate the supporting evidence in the protocol and add provenance.

You are provided with:
1. Extracted concomitant medications data from Pass 1
2. The original protocol PDF

Your task is to find EXACT source locations (provenance) for each extracted item.

---

## PROVENANCE STRUCTURE

For each provenance object, provide:
```json
{
  "section_number": "6.3.1",
  "page_number": 55,
  "text_snippet": "Direct quote from protocol (max 500 chars)"
}
```

- **section_number**: Exact section from protocol (e.g., "6.3", "6.5.1") - can be null if unknown
- **page_number**: PDF page number (integer, 1-indexed) - REQUIRED
- **text_snippet**: Direct quote from protocol (max 500 chars, truncate with "...") - REQUIRED

---

## PASS 1 EXTRACTION (Data Requiring Provenance)

{{ extracted_values }}

---

## PROVENANCE PATHS TO POPULATE

**Root Level:**
- $.provenance

**Prohibited Medications:**
- $.prohibited_medications[*].provenance (EACH prohibited medication)

**Restricted Medications:**
- $.restricted_medications[*].provenance (EACH restricted medication)

**Required Medications:**
- $.required_medications[*].provenance (EACH required medication)

**Rescue Medications:**
- $.rescue_medications[*].provenance (EACH rescue medication)

**Washout Requirements:**
- $.washout_requirements[*].provenance (EACH washout requirement)

**Drug Interactions:**
- $.drug_interactions[*].provenance (EACH drug interaction)

**Allowed Medications:**
- $.allowed_medications[*].provenance (EACH allowed medication)

**Vaccine Policy:**
- $.vaccine_policy.provenance

**Herbal Supplements Policy:**
- $.herbal_supplements_policy.provenance

**Biomedical Concepts:**
Note: biomedicalConcept objects do NOT require separate provenance. They inherit provenance from their parent medication object.

---

## SEARCH STRATEGY

| Content Type | Typical Sections |
|--------------|------------------|
| Prohibited Medications | 6.3, 6.4.1, "Prohibited Medications" |
| Restricted Medications | 6.3, 6.4.2, "Restricted Medications" |
| Required/Premedications | 6.2, 6.1, "Premedication" |
| Rescue Medications | 6.4, "Rescue Therapy" |
| Washout Requirements | 5.2, Exclusion Criteria, "Prior Therapy" |
| Drug Interactions | 6.5, Appendix, "Drug-Drug Interactions" |
| Vaccines | 6.6, 6.3.5 |
| Herbal Supplements | 6.3.4, "Dietary Restrictions" |

---

## TEXT SNIPPET RULES

1. **EXACT QUOTE**: Copy text exactly as it appears
2. **MAX 500 CHARACTERS**: Truncate with "..." if longer
3. **MOST RELEVANT PORTION**: Select phrase that directly supports the value
4. **CLEAN WHITESPACE**: Remove excess line breaks

---

## CRITICAL: DO NOT MODIFY PRIMITIVE ARRAYS

**IMPORTANT**: The following array fields contain PLAIN STRINGS. Do NOT convert them to objects with value/provenance.

**Arrays that must remain as plain string arrays:**
- `specific_drugs`: ["drug1", "drug2"] ← KEEP AS STRINGS
- `affected_drugs`: ["drug1", "drug2"] ← KEEP AS STRINGS
- `alternatives`: ["alt1", "alt2"] ← KEEP AS STRINGS
- `prohibited_supplements`: ["supplement1"] ← KEEP AS STRINGS
- `specific_restrictions`: ["restriction1"] ← KEEP AS STRINGS

**BAD (DO NOT DO THIS):**
```json
"specific_drugs": [
  {"value": "ketoconazole", "provenance": {...}},
  {"value": "itraconazole", "provenance": {...}}
]
```

**GOOD (CORRECT FORMAT):**
```json
"specific_drugs": ["ketoconazole", "itraconazole"],
"provenance": {
  "section_number": "6.3.1",
  "page_number": 58,
  "text_snippet": "ketoconazole, itraconazole, and other strong CYP3A4 inhibitors..."
}
```

Provenance goes at the PARENT OBJECT level, covering all fields within that object including string arrays.

---

## CRITICAL PAGE NUMBER RULES

1. Use PHYSICAL page numbers (1st page of PDF = 1)
2. Do NOT use printed page numbers in headers/footers
3. The text_snippet MUST appear on the EXACT page_number you specify

---

## OUTPUT FORMAT

Return the COMPLETE Pass 1 JSON with provenance added to ALL locations listed above.

Example structure:
```json
{
  "id": "PROTOCOL_ID-concomitant-medications",
  "instanceType": "ConcomitantMedicationRestrictions",
  "name": "PROTOCOL_ID Concomitant Medication Restrictions",
  "description": "Medication restrictions for PROTOCOL_ID",

  "prohibited_medications": [
    {
      "id": "proh-001",
      "instanceType": "ProhibitedMedication",
      "medication_class": "Strong CYP3A4 Inhibitors",
      "specific_drugs": ["ketoconazole", "itraconazole"],
      "prohibition_reason": {"decode": "pk_interaction"},
      "prohibition_reason_detail": "May increase study drug exposure",
      "prohibition_period": {"decode": "entire_study"},
      "provenance": {
        "section_number": "6.3.1",
        "page_number": 58,
        "text_snippet": "Strong CYP3A4 inhibitors are prohibited during the study..."
      }
    }
  ],

  "restricted_medications": [
    {
      "id": "rest-001",
      "instanceType": "RestrictedMedication",
      "medication_class": "Corticosteroids",
      "restriction_type": {"decode": "dose_limit"},
      "conditions": {"max_dose": "10mg/day prednisone equivalent"},
      "provenance": {
        "section_number": "6.3.2",
        "page_number": 59,
        "text_snippet": "Corticosteroids are permitted at doses ≤10mg/day prednisone..."
      }
    }
  ],

  "required_medications": [
    {
      "id": "req-001",
      "instanceType": "RequiredMedication",
      "medication_name": "diphenhydramine",
      "requirement_type": {"decode": "premedication"},
      "provenance": {
        "section_number": "6.2",
        "page_number": 56,
        "text_snippet": "Premedication with diphenhydramine 50mg PO is required..."
      }
    }
  ],

  "rescue_medications": [],

  "washout_requirements": [
    {
      "id": "wash-001",
      "instanceType": "WashoutRequirement",
      "medication_class": "Prior Checkpoint Inhibitors",
      "washout_duration_days": 28,
      "provenance": {
        "section_number": "5.2",
        "page_number": 35,
        "text_snippet": "4-week washout from prior immunotherapy is required..."
      }
    }
  ],

  "drug_interactions": [
    {
      "id": "int-001",
      "instanceType": "DrugInteraction",
      "interaction_type": {"decode": "CYP3A4_inhibitor"},
      "severity": {"decode": "strong"},
      "management": {"decode": "prohibited"},
      "provenance": {
        "section_number": "6.5",
        "page_number": 62,
        "text_snippet": "Strong CYP3A4 inhibitors may increase exposure by >5-fold..."
      }
    }
  ],

  "allowed_medications": [],

  "vaccine_policy": {
    "instanceType": "VaccinePolicy",
    "live_vaccines_prohibited": true,
    "provenance": {
      "section_number": "6.6",
      "page_number": 63,
      "text_snippet": "Live vaccines are prohibited during treatment..."
    }
  },

  "herbal_supplements_policy": {
    "instanceType": "HerbalSupplementsPolicy",
    "prohibited_supplements": ["St. John's Wort"],
    "provenance": {
      "section_number": "6.3.4",
      "page_number": 60,
      "text_snippet": "St. John's Wort is prohibited due to CYP3A4 induction..."
    }
  },

  "provenance": {
    "section_number": "6",
    "page_number": 55,
    "text_snippet": "CONCOMITANT MEDICATIONS"
  }
}
```

---

## VALIDATION CHECKLIST (MANDATORY)

**Before returning, verify ALL of these provenance objects exist:**

Root Level:
- [ ] `$.provenance` exists with page_number and text_snippet

Array Items:
- [ ] Every item in `prohibited_medications[]` has provenance
- [ ] Every item in `restricted_medications[]` has provenance
- [ ] Every item in `required_medications[]` has provenance
- [ ] Every item in `rescue_medications[]` has provenance
- [ ] Every item in `washout_requirements[]` has provenance
- [ ] Every item in `drug_interactions[]` has provenance
- [ ] Every item in `allowed_medications[]` has provenance

Optional Sections (if present and not null):
- [ ] `$.vaccine_policy.provenance` exists
- [ ] `$.herbal_supplements_policy.provenance` exists

Format Requirements:
- [ ] All page_number values are integers (1-indexed)
- [ ] All text_snippets are ≤500 characters
- [ ] text_snippets are EXACT quotes from the document
- [ ] Primitive arrays remain as plain strings (specific_drugs, affected_drugs, alternatives, prohibited_supplements, specific_restrictions)
- [ ] No values were modified from Pass 1

**DO NOT RETURN until ALL checkboxes above are satisfied.**

---

## OUTPUT

Return ONLY valid JSON. No markdown fences, no explanations.
Return the complete merged JSON object with all Pass 1 data PLUS provenance.
