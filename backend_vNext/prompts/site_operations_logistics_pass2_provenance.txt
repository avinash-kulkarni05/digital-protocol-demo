system
You are an expert clinical trial document analyst specializing in locating exact source references in clinical protocol documents.

user
# SITE OPERATIONS & LOGISTICS - PASS 2: PROVENANCE EXTRACTION

## OBJECTIVE
Add provenance (source references) to ALL values extracted in Pass 1. For EVERY extracted element, locate the supporting evidence in the protocol and add provenance.

You are provided with:
1. Extracted site operations and logistics data from Pass 1
2. The original protocol PDF

Your task is to find EXACT source locations (provenance) for each extracted item.

---

## CRITICAL: 100% PROVENANCE COVERAGE REQUIRED

**EVERY extracted field MUST have provenance coverage.** Provenance coverage means either:
1. The field's parent object has a `provenance` object, OR
2. The field has a sibling `{fieldName}Provenance` object

**FAILURE MODE**: If ANY section is missing a `provenance` object, the quality check FAILS.

**MANDATORY ROOT PROVENANCE OBJECTS** - You MUST add `provenance` to ALL these paths:
- `$.provenance` - Root document provenance (REQUIRED)
- `$.site_selection.provenance` - Site selection section (REQUIRED)
- `$.regulatory_ethics.provenance` - Regulatory/ethics section (REQUIRED)
- `$.site_personnel.provenance` - Personnel section (REQUIRED)
- `$.training_requirements.provenance` - Training section (REQUIRED)
- `$.monitoring_plan.provenance` - Monitoring section (REQUIRED)
- `$.site_activation_timeline.provenance` - Timeline section (REQUIRED)
- `$.drug_supply_logistics.provenance` - Drug supply section (REQUIRED)
- `$.technology_systems.provenance` - Technology section (REQUIRED)
- `$.equipment_facilities.provenance` - Equipment section (REQUIRED)

**If a section has minimal content**, use the section heading as provenance:
```json
"site_activation_timeline": {
  "instanceType": "SiteActivationTimeline",
  "provenance": {
    "section_number": "8",
    "page_number": 95,
    "text_snippet": "SITE OPERATIONS"
  }
}
```

---

## PROVENANCE STRUCTURE

For each provenance object, provide:
```json
{
  "section_number": "8.1",
  "page_number": 95,
  "text_snippet": "Direct quote from protocol (max 500 chars)"
}
```

- **section_number**: SHORT section number ONLY (e.g., "8", "8.1", "8.2.3"). MAX 20 characters. Do NOT use full section titles. Can be null if unknown.
- **page_number**: PDF page number (integer, 1-indexed) - REQUIRED
- **text_snippet**: Direct quote from protocol (STRICT MAX 500 chars). Truncate with "..." if longer. - REQUIRED

---

## PASS 1 EXTRACTION (Data Requiring Provenance)

{{ extracted_values }}

---

## PROVENANCE PATHS TO POPULATE

**Root Level:**
- $.provenance

**Site Selection (Domain 1 - ICH M11 Section 8.1):**
- $.site_selection.provenance
- $.site_selection.required_criteria[*].provenance (EACH criterion)
- $.site_selection.geographic_requirements.provenance
- $.site_selection.facility_requirements.provenance
- $.site_selection.experience_requirements.provenance

**Regulatory & Ethics:**
- $.regulatory_ethics.provenance
- $.regulatory_ethics.regulatory_authorities[*].provenance (EACH authority)
- $.regulatory_ethics.ethics_committees[*].provenance (EACH committee)
- $.regulatory_ethics.informed_consent.provenance
- $.regulatory_ethics.data_privacy.provenance

**Site Personnel:**
- $.site_personnel.provenance
- $.site_personnel.principal_investigator.provenance
- $.site_personnel.sub_investigators.provenance
- $.site_personnel.coordinators.provenance
- $.site_personnel.other_personnel[*].provenance (EACH role)

**Training Requirements:**
- $.training_requirements.provenance
- $.training_requirements.protocol_training.provenance
- $.training_requirements.gcp_training.provenance
- $.training_requirements.specialized_training[*].provenance (EACH training)

**Monitoring Plan:**
- $.monitoring_plan.provenance
- $.monitoring_plan.site_initiation_visit.provenance
- $.monitoring_plan.routine_monitoring.provenance
- $.monitoring_plan.triggered_monitoring.provenance
- $.monitoring_plan.close_out_visit.provenance

**Site Activation Timeline:**
- $.site_activation_timeline.provenance

**Drug Supply Logistics (Domain 2 - ICH M11 Section 8.2):**
- $.drug_supply_logistics.provenance
- $.drug_supply_logistics.packaging_labeling.provenance
- $.drug_supply_logistics.storage_distribution.provenance
- $.drug_supply_logistics.inventory_management.provenance
- $.drug_supply_logistics.dispensing_schedule[*].provenance (EACH dispensing event)
- $.drug_supply_logistics.drug_accountability.provenance
- $.drug_supply_logistics.drug_return_destruction.provenance
- $.drug_supply_logistics.dosing_error_handling.provenance
- $.drug_supply_logistics.comparator_medications[*].provenance (EACH comparator)
- $.drug_supply_logistics.emergency_unblinding.provenance

**Technology Systems:**
- $.technology_systems.provenance
- $.technology_systems.edc_system.provenance
- $.technology_systems.iwrs_rtsm.provenance
- $.technology_systems.epro_devices.provenance
- $.technology_systems.central_services[*].provenance (EACH service)

**Equipment & Facilities:**
- $.equipment_facilities.provenance
- $.equipment_facilities.specialized_equipment[*].provenance (EACH equipment)
- $.equipment_facilities.facility_requirements.provenance

**Vendor Coordination:**
- $.vendor_coordination[*].provenance (EACH vendor)

---

## SEARCH STRATEGY

| Content Type | Typical Sections |
|--------------|------------------|
| Site Selection | 8.1, "Site Selection", "Investigational Sites" |
| Regulatory/IRB | 10, 11, "Regulatory", "Ethics", "IRB/IEC" |
| Personnel | 8.1, "Investigator Responsibilities", "Study Personnel" |
| Training | 8.1, "Training Requirements", "Investigator Meetings" |
| Monitoring | 10, "Monitoring Plan", "Quality Assurance" |
| Activation Timeline | 8.1, "Study Timeline", "Site Activation" |
| Drug Supply | 6, 8.2, "Study Drug", "IP Management" |
| Drug Dispensing | 6, "Drug Dispensing", "IP Dispensing Schedule" |
| Drug Accountability | 6, "Drug Accountability", "IP Accountability" |
| Drug Return/Destruction | 6, "Drug Return", "Destruction", "Disposal" |
| Dosing Errors | 6, "Missed Dose", "Overdose", "Dosing Errors" |
| Comparator Medications | 6, "Comparator", "Active Control", "Rescue Medication" |
| Emergency Unblinding | 6, 5, "Unblinding", "Code Break", "Emergency Unblinding" |
| Technology/EDC | 9, "Data Collection", "Electronic Data Capture" |
| Equipment | 8, "Facility Requirements", "Equipment" |
| Vendors | 8, "Third Party Vendors", "Service Providers" |

---

## TEXT SNIPPET RULES

1. **EXACT QUOTE**: Copy text exactly as it appears
2. **STRICT MAX 500 CHARACTERS**: If text exceeds 500 chars, TRUNCATE with "..." IMMEDIATELY. This is a hard limit.
3. **MOST RELEVANT PORTION**: Select the SHORTEST phrase that directly supports the value
4. **CLEAN WHITESPACE**: Remove excess line breaks, collapse multiple spaces

---

## CRITICAL: DO NOT MODIFY PRIMITIVE ARRAYS

**EXTREMELY IMPORTANT**: The following array fields contain PLAIN STRINGS. Do NOT convert them to objects with value/provenance.

**Arrays that must remain as PLAIN STRING arrays:**
- `countries`: ["USA", "DEU", "JPN"] ← KEEP AS PLAIN STRINGS
- `regions`: ["North America", "Europe"] ← KEEP AS PLAIN STRINGS
- `language_requirements`: ["English", "Spanish"] ← KEEP AS PLAIN STRINGS
- `equipment_required`: ["MRI", "CT"] ← KEEP AS PLAIN STRINGS
- `laboratory_capabilities`: ["Phlebotomy"] ← KEEP AS PLAIN STRINGS
- `safety_equipment`: ["Resuscitation equipment"] ← KEEP AS PLAIN STRINGS
- `qualifications_required`: ["MD or equivalent"] ← KEEP AS PLAIN STRINGS
- `responsibilities`: ["Patient safety"] ← KEEP AS PLAIN STRINGS
- `delegation_restrictions`: ["Informed consent"] ← KEEP AS PLAIN STRINGS
- `delegated_duties`: ["AE assessment"] ← KEEP AS PLAIN STRINGS
- `required_for`: ["PI", "Sub-I", "CRC"] ← KEEP AS PLAIN STRINGS
- `activities`: ["Regulatory review"] ← KEEP AS PLAIN STRINGS
- `sdv_scope`: ["Informed consent", "SAEs"] ← KEEP AS PLAIN STRINGS
- `triggers`: ["SAE", "Protocol deviation"] ← KEEP AS PLAIN STRINGS
- `escalation_criteria`: ["Repeated deviations"] ← KEEP AS PLAIN STRINGS
- `critical_path_items`: ["IRB approval"] ← KEEP AS PLAIN STRINGS
- `label_languages`: ["English"] ← KEEP AS PLAIN STRINGS
- `system_capabilities`: ["randomization"] ← KEEP AS PLAIN STRINGS
- `integration_requirements`: ["IWRS"] ← KEEP AS PLAIN STRINGS
- `special_designations`: ["breakthrough_therapy"] ← KEEP AS PLAIN STRINGS
- `reconsent_triggers`: ["protocol_amendment"] ← KEEP AS PLAIN STRINGS
- `applicable_regulations`: ["GDPR", "HIPAA"] ← KEEP AS PLAIN STRINGS
- `services_provided`: ["Monitoring"] ← KEEP AS PLAIN STRINGS
- `instruments_collected`: ["Daily diary"] ← KEEP AS PLAIN STRINGS
- `functions`: ["randomization"] ← KEEP AS PLAIN STRINGS
- `kits_dispensed`: ["IP Kit", "Placebo Kit"] ← KEEP AS PLAIN STRINGS
- `unblinding_triggers`: ["medical_emergency"] ← KEEP AS PLAIN STRINGS
- `who_can_unblind`: ["Investigator"] ← KEEP AS PLAIN STRINGS

**WRONG** (Do NOT do this):
```json
"countries": [
  {"value": "USA", "provenance": {...}},  // WRONG!
]
```

**CORRECT** (Do this instead):
```json
"countries": ["USA", "DEU", "JPN"],  // CORRECT - plain strings
"provenance": { ... }  // Provenance at PARENT object level only
```

---

## CRITICAL PAGE NUMBER RULES

1. Use PHYSICAL page numbers (1st page of PDF = 1)
2. Do NOT use printed page numbers in headers/footers
3. The text_snippet MUST appear on the EXACT page_number you specify

---

## OUTPUT FORMAT

Return the COMPLETE Pass 1 JSON with provenance added to ALL locations listed above.

Example structure:
```json
{
  "id": "PROTOCOL_ID-site-operations-logistics",
  "instanceType": "SiteOperationsLogistics",
  "name": "PROTOCOL_ID Site Operations & Logistics",

  "site_selection": {
    "instanceType": "SiteSelectionCriteria",
    "required_criteria": [
      {
        "id": "REQ-001",
        "criterion": "Patient population access",
        "description": "Access to target patient population",
        "assessment_method": "Feasibility questionnaire",
        "minimum_requirement": "50+ patients annually",
        "provenance": {
          "section_number": "8.1.1",
          "page_number": 95,
          "text_snippet": "Sites must have access to at least 50 eligible patients..."
        }
      }
    ],
    "geographic_requirements": {
      "countries": ["USA", "DEU", "JPN"],
      "regions": ["North America", "Europe", "Asia-Pacific"],
      "site_count_target": 150,
      "provenance": {
        "section_number": "8.1.2",
        "page_number": 96,
        "text_snippet": "Approximately 150 sites in North America, Europe, and Asia..."
      }
    },
    "provenance": {
      "section_number": "8.1",
      "page_number": 95,
      "text_snippet": "SITE SELECTION CRITERIA"
    }
  },

  "regulatory_ethics": {
    "instanceType": "RegulatoryEthics",
    "regulatory_authorities": [
      {
        "id": "AUTH-001",
        "authority_name": "FDA",
        "country_region": "USA",
        "submission_type": "IND",
        "provenance": {
          "section_number": "10.1",
          "page_number": 110,
          "text_snippet": "IND application submitted to FDA under IND 123456..."
        }
      }
    ],
    "provenance": {
      "section_number": "10",
      "page_number": 110,
      "text_snippet": "REGULATORY AND ETHICS REQUIREMENTS"
    }
  },

  "drug_supply_logistics": {
    "instanceType": "DrugSupplyLogistics",
    "packaging_labeling": {
      "blinding_requirements": "double_blind",
      "label_languages": ["English", "Local language"],
      "temperature_indicators": true,
      "provenance": {
        "section_number": "6.3",
        "page_number": 65,
        "text_snippet": "Study drug will be supplied in double-blind kits with temperature..."
      }
    },
    "storage_distribution": {
      "storage_temperature": "2-8°C",
      "distribution_model": "depot",
      "cold_chain_required": true,
      "provenance": {
        "section_number": "6.4",
        "page_number": 66,
        "text_snippet": "Study drug must be stored at 2-8°C and distributed via depot..."
      }
    },
    "provenance": {
      "section_number": "6",
      "page_number": 65,
      "text_snippet": "STUDY DRUG MANAGEMENT"
    }
  },

  "technology_systems": {
    "instanceType": "TechnologySystems",
    "edc_system": {
      "vendor_name": "Medidata Rave",
      "system_capabilities": ["randomization", "ePRO", "audit_trail"],
      "provenance": {
        "section_number": "9.1",
        "page_number": 100,
        "text_snippet": "Electronic data capture using Medidata Rave with integrated..."
      }
    },
    "provenance": {
      "section_number": "9",
      "page_number": 100,
      "text_snippet": "DATA COLLECTION AND MANAGEMENT"
    }
  },

  "provenance": {
    "section_number": "8",
    "page_number": 95,
    "text_snippet": "SITE OPERATIONS AND LOGISTICS"
  }
}
```

---

## VALIDATION CHECKLIST (MANDATORY)

**Before returning, verify ALL of these provenance objects exist:**

✅ Root Level:
- [ ] `$.provenance` exists with page_number and text_snippet

✅ Section Level (ALL 10 REQUIRED):
- [ ] `$.site_selection.provenance` exists
- [ ] `$.regulatory_ethics.provenance` exists
- [ ] `$.site_personnel.provenance` exists
- [ ] `$.training_requirements.provenance` exists
- [ ] `$.monitoring_plan.provenance` exists
- [ ] `$.site_activation_timeline.provenance` exists
- [ ] `$.drug_supply_logistics.provenance` exists
- [ ] `$.technology_systems.provenance` exists
- [ ] `$.equipment_facilities.provenance` exists
- [ ] `$.vendor_coordination` array items each have provenance

✅ Nested Objects (ALL REQUIRED):
- [ ] `$.site_selection.geographic_requirements.provenance` exists
- [ ] `$.site_selection.facility_requirements.provenance` exists
- [ ] `$.regulatory_ethics.informed_consent.provenance` exists
- [ ] `$.regulatory_ethics.data_privacy.provenance` exists
- [ ] `$.site_personnel.principal_investigator.provenance` exists
- [ ] `$.training_requirements.protocol_training.provenance` exists
- [ ] `$.training_requirements.gcp_training.provenance` exists
- [ ] `$.monitoring_plan.routine_monitoring.provenance` exists
- [ ] `$.drug_supply_logistics.packaging_labeling.provenance` exists
- [ ] `$.drug_supply_logistics.storage_distribution.provenance` exists
- [ ] `$.drug_supply_logistics.drug_accountability.provenance` exists (if present)
- [ ] `$.drug_supply_logistics.drug_return_destruction.provenance` exists (if present)
- [ ] `$.drug_supply_logistics.dosing_error_handling.provenance` exists (if present)
- [ ] `$.drug_supply_logistics.emergency_unblinding.provenance` exists (if present)
- [ ] `$.technology_systems.edc_system.provenance` exists

✅ Array Items:
- [ ] Every item in `regulatory_authorities[]` has provenance
- [ ] Every item in `ethics_committees[]` has provenance
- [ ] Every item in `other_personnel[]` has provenance
- [ ] Every item in `specialized_training[]` has provenance
- [ ] Every item in `specialized_equipment[]` has provenance
- [ ] Every item in `central_services[]` has provenance
- [ ] Every item in `vendor_coordination[]` has provenance
- [ ] Every item in `dispensing_schedule[]` has provenance (if present)
- [ ] Every item in `comparator_medications[]` has provenance (if present)

✅ Format Requirements:
- [ ] All page_number values are integers (1-indexed)
- [ ] All text_snippets are ≤500 characters
- [ ] text_snippets are EXACT quotes from the document
- [ ] Primitive arrays remain as plain strings

**DO NOT RETURN until ALL checkboxes above are satisfied.**

---

## OUTPUT

Return ONLY valid JSON. No markdown fences, no explanations.
Return the complete merged JSON object with all Pass 1 data PLUS provenance for EVERY section.