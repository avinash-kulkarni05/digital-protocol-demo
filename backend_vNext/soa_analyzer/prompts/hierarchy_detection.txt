You are a clinical trial protocol expert. Your task is to analyze a list of clinical trial activities and determine their hierarchical organization.

## Context

Schedule of Assessments (SOA) tables often have implicit hierarchies where:
- Header rows group related activities (e.g., "LABORATORY TESTS" groups Hematology, Chemistry, Urinalysis)
- Some activities are sub-items of others (e.g., "CBC" might be under "Hematology")
- CDISC domains provide natural groupings (LB = Laboratory, VS = Vital Signs)

## Activities to Analyze

{activities_json}

## Instructions

Analyze the activities and identify hierarchical relationships:

1. **Detect Header Rows**: Activities that serve as section headers (not actual assessments)
2. **Identify Parent-Child Relationships**: Activities that belong under other activities
3. **Suggest Domain Groupings**: How activities should be grouped by CDISC domain

### Header Row Indicators
- ALL CAPS text (e.g., "LABORATORY TESTS")
- No timing markers in SOA (activity never checked)
- Generic category names (e.g., "Safety Assessments", "Efficacy Assessments")
- Text ending with colon or containing "section"

### Parent-Child Indicators
- Indentation in original table
- Naming patterns (e.g., "Hematology - CBC" suggests CBC is child of Hematology)
- Logical containment (Chemistry contains Electrolytes)

## Response Format

Return a JSON object with:

```json
{{
  "headerRows": [
    {{
      "activityId": "ACT-001",
      "activityName": "LABORATORY TESTS",
      "isHeader": true,
      "confidence": 0.95,
      "rationale": "All caps text, appears to be a section header"
    }}
  ],
  "parentChildRelationships": [
    {{
      "parentActivityId": "ACT-001",
      "parentActivityName": "LABORATORY TESTS",
      "childActivityIds": ["ACT-002", "ACT-003", "ACT-004"],
      "confidence": 0.90,
      "rationale": "These activities appear under the Laboratory Tests header"
    }}
  ],
  "domainGroupings": [
    {{
      "domain": "LB",
      "domainName": "Laboratory Tests",
      "activityIds": ["ACT-002", "ACT-003", "ACT-004"],
      "suggestedParent": "ACT-001"
    }},
    {{
      "domain": "VS",
      "domainName": "Vital Signs",
      "activityIds": ["ACT-010", "ACT-011"],
      "suggestedParent": null
    }}
  ],
  "hierarchyTree": [
    {{
      "id": "ROOT-LB",
      "name": "Laboratory Tests",
      "domain": "LB",
      "nodeType": "category",
      "children": [
        {{
          "id": "ACT-002",
          "name": "Hematology",
          "domain": "LB",
          "nodeType": "activity"
        }},
        {{
          "id": "ACT-003",
          "name": "Clinical Chemistry",
          "domain": "LB",
          "nodeType": "activity"
        }}
      ]
    }}
  ]
}}
```

## Critical Requirements

1. Every activity should appear somewhere in the hierarchy
2. Header rows should NOT be treated as actual activities requiring execution
3. Use CDISC domains as the primary grouping mechanism
4. Confidence â‰¥0.90 for clear hierarchies, 0.70-0.89 for inferred relationships
5. Return ONLY valid JSON, no markdown formatting

Analyze ALL {activity_count} activities now.
