You are validating clinical component names extracted from a Schedule of Assessments (SOA).

## Task

For each candidate component name, determine:
1. Is it a VALID clinical component (test, measurement, procedure)?
2. Confidence score (0.0 - 1.0)
3. If duplicate of another item in the list, identify the canonical form
4. Brief rationale for the decision

## Activity Context

Activity Name: {activity_name}
CDISC Domain: {cdash_domain}

## Existing Components (Already in Activity)

The following components already exist for this activity. Mark any candidate
that is semantically equivalent to an existing component as INVALID:

{existing_components}

### Semantic Duplicate Detection Rules:
- If "NSCLC TNM staging" exists and candidate is "TNM staging" → INVALID (subset of existing)
- If "Head and neck evaluation" exists and candidate is "Head and Neck Examination" → INVALID (same concept)
- If "Alanine Aminotransferase (ALT)" exists and candidate is "SGPT/ALT" → INVALID (same test)
- If activity name is "Urinalysis" and candidate is "Urinalysis" → INVALID (parent as component)
- If "White Blood Cell Count" exists and candidate is "WBC" → INVALID (abbreviation of existing)

For semantic duplicates, use:
- is_valid: false
- rationale: "Semantic duplicate of existing component: [existing_name]"

## Candidate Components to Validate

{component_list}

## Validation Rules

### VALID Components (include these):
- Specific clinical test names: "Hemoglobin", "White Blood Cell Count", "Heart Rate", "Blood Pressure"
- LOINC-codable parameters: "Platelet Count", "Serum Creatinine", "ALT", "AST"
- Clinical procedures: "Physical Exam", "ECG", "Urinalysis", "CT Scan"
- Standard abbreviations: "WBC", "RBC", "ALT", "AST", "QTcF", "BUN"
- Body system evaluations: "Neurological evaluation", "Cardiac evaluation", "Skin evaluation"
- Specimen-related: "Blood sample", "Urine collection", "Tissue biopsy"

### INVALID Components (reject these):
- **Table headers/formatting**: "Table 5. Clinical Laboratory Tests", "Hematology", "Clinical Chemistry", "Tests"
- **Procedural notes**: "per Table 2", "at the Screening Visit only", "as applicable", "if clinically indicated"
- **Incomplete fragments**: "neurological (sensory", "cranial nerves)", "motor", "head", "neck"
- **Generic instructions**: "see Section X", "refer to Appendix", "as per protocol"
- **Column headers**: "Parameter", "Timing", "Visit Window", "Schedule"
- **Section dividers**: "---", "***", continuation markers
- **Pure numbers or single characters**: "1", "a", "X"
- **Category headers without specifics**: "Hematology" (unless it's a single composite test), "Chemistry" (unless specific)

## Duplicate Detection

Identify semantically equivalent components and keep the most descriptive canonical form:
- "WBC" and "White Blood Cell Count" → keep "White Blood Cell Count"
- "Hgb" and "Hemoglobin" → keep "Hemoglobin"
- "HR" and "Heart Rate" → keep "Heart Rate"
- "BP" and "Blood Pressure" → keep "Blood Pressure"
- "RBC" and "Red Blood Cell Count" → keep "Red Blood Cell Count"
- "PLT" and "Platelet Count" → keep "Platelet Count"
- "Temp" and "Temperature" and "Body Temperature" → keep "Body Temperature"

## Confidence Scoring Guidelines

- **0.95-1.0**: Clearly a clinical test/measurement with standard terminology (LOINC-codable)
- **0.85-0.94**: Valid clinical component but less common or protocol-specific naming
- **0.70-0.84**: Possibly valid but ambiguous - may need human review
- **<0.70**: Likely invalid (garbage, fragment, or non-component text)

For INVALID items, confidence represents certainty that it IS garbage (higher = more certain it's invalid).

## Output Format (JSON Only)

Return ONLY valid JSON with no markdown wrapping:

{{
  "validated_components": [
    {{
      "name": "Hemoglobin",
      "is_valid": true,
      "confidence": 0.95,
      "canonical_form": "Hemoglobin",
      "rationale": "Standard hematology test, LOINC-codable (718-7)"
    }},
    {{
      "name": "WBC",
      "is_valid": true,
      "confidence": 0.95,
      "canonical_form": "White Blood Cell Count",
      "rationale": "Standard abbreviation for White Blood Cell Count, LOINC-codable"
    }},
    {{
      "name": "per Table 2",
      "is_valid": false,
      "confidence": 0.98,
      "canonical_form": null,
      "rationale": "Procedural reference, not a clinical component"
    }},
    {{
      "name": "neurological (sensory",
      "is_valid": false,
      "confidence": 0.95,
      "canonical_form": null,
      "rationale": "Incomplete fragment with unbalanced parenthesis"
    }},
    {{
      "name": "Hematology",
      "is_valid": false,
      "confidence": 0.90,
      "canonical_form": null,
      "rationale": "Category header, not a specific test - individual tests should be listed separately"
    }}
  ],
  "deduplication_groups": [
    {{
      "canonical": "White Blood Cell Count",
      "duplicates": ["WBC", "White blood cell count", "Leukocyte Count"],
      "confidence": 0.95,
      "rationale": "All refer to the same hematology test"
    }},
    {{
      "canonical": "Hemoglobin",
      "duplicates": ["Hgb", "HGB"],
      "confidence": 0.95,
      "rationale": "Standard abbreviations for Hemoglobin"
    }}
  ],
  "summary": {{
    "total_candidates": 15,
    "valid_count": 10,
    "invalid_count": 5,
    "duplicate_groups": 2
  }}
}}

## Critical Rules

1. **Be conservative** - When in doubt, mark as invalid with lower confidence
2. **Preserve legitimate components** - Don't reject valid tests just because names are unusual
3. **Semantic understanding** - Use clinical knowledge to identify duplicates
4. **No hallucination** - Only validate what's in the input, don't add components
5. **Consistent confidence** - Similar items should have similar confidence scores
